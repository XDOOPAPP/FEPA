import{j as e}from"./vendor-CIDEvgjn.js";import{r as a,u as t}from"./react-YvAU7kAw.js";import{s}from"./subscriptionAPI-BwKWqfSG.js";import{u as l,a as i,b as n,c as o}from"./queries-BYgdP70j.js";import{b as c}from"./blogAPI-FLO4H6ir.js";import{a as r}from"./adminApiService-BA07r5pn.js";import{R as d,a as u,b as h,c as v,d as g,e as m}from"./index-DEkLrubD.js";import{R as j}from"./DollarOutlined-DDRiT3BV.js";import{R as x}from"./ShoppingOutlined-BlmXKr7L.js";import{R as p}from"./PieChartOutlined-U9C0tV0i.js";import{I as y,_ as f,T as k,C as b,h as N,i as S,S as R,o as U,A as T,l as C}from"./antd-Ca0_LWAN.js";import{R as $,P as A,a as I,C as B,T as L,L as _,B as w,b as M,X as P,Y as q,c as z}from"./recharts-OKR9gfyr.js";import"./ocrAPI-D8COPIfY.js";import"./aiAPI-CydZBJ1Y.js";import"./socket-CUkmNz_4.js";var E={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 248H728l-32.4-90.8a32.07 32.07 0 00-30.2-21.2H358.6c-13.5 0-25.6 8.5-30.1 21.2L296 248H160c-44.2 0-80 35.8-80 80v456c0 44.2 35.8 80 80 80h704c44.2 0 80-35.8 80-80V328c0-44.2-35.8-80-80-80zm8 536c0 4.4-3.6 8-8 8H160c-4.4 0-8-3.6-8-8V328c0-4.4 3.6-8 8-8h186.7l17.1-47.8 22.9-64.2h250.5l22.9 64.2 17.1 47.8H864c4.4 0 8 3.6 8 8v456zM512 384c-88.4 0-160 71.6-160 160s71.6 160 160 160 160-71.6 160-160-71.6-160-160-160zm0 256c-53 0-96-43-96-96s43-96 96-96 96 43 96 96-43 96-96 96z"}}]},name:"camera",theme:"outlined"},O=function(e,t){return a.createElement(y,f({},e,{ref:t,icon:E}))},D=a.forwardRef(O);const{Title:H,Text:F}=k,K=e.jsx(C,{style:{fontSize:20}}),V=e=>Number(e||0).toLocaleString("vi-VN"),J=()=>{const y=t(),[f,k]=a.useState({totalUsers:0,totalRevenue:0,activeUsers:0}),[C,E]=a.useState({}),[O,J]=a.useState({totalRevenue:0}),[X,Y]=a.useState(!1),[G,Q]=a.useState([]),[W,Z]=a.useState(!1),{data:ee,isLoading:ae}=l(),{data:te,isLoading:se}=i(),{data:le,isLoading:ie}=n(),{data:ne,isLoading:oe}=o();a.useEffect(()=>{re(),de(),ce()},[]);const ce=async()=>{Z(!0);try{const e=await s.getRevenueByPlan(),a=Array.isArray(e)?e.map(e=>{var a;return{plan:(null==(a=e._id)?void 0:a.planName)||e.plan||"Unknown",revenue:e.totalRevenue||e.revenue||0,count:e.subscriptionCount||e.count||0}}):[];Q(a)}catch(e){Q([])}finally{Z(!1)}},re=async()=>{try{let a=0,t=0,l=0;try{const e=await r.getUserStats(),s=(null==e?void 0:e.data)||e||{};a=s.total||s.totalUsers||0,t=s.active||s.activeUsers||0}catch(e){}try{const e=await s.getRevenueTotals();if(e){l=(e.data||e).totalRevenue||0}}catch(e){}k({totalUsers:a,totalRevenue:l,activeUsers:t})}catch(e){k({totalUsers:0,totalRevenue:0,activeUsers:0})}},de=async()=>{var e;Y(!0);try{const[a,t]=await Promise.allSettled([c.getStatusStats(),s.getRevenueTotals()]);if("fulfilled"===a.status&&a.value?E(a.value||{}):E({}),"fulfilled"===t.status&&t.value){const a=(null==(e=t.value)?void 0:e.data)||t.value||{totalRevenue:0};J(a)}else J({totalRevenue:0})}catch(a){E({}),J({totalRevenue:0})}finally{Y(!1)}},ue=(C.pending||0)+(C.published||0)+(C.rejected||0)+(C.draft||0),he=f.totalUsers?Math.round(f.activeUsers/Math.max(f.totalUsers,1)*100):0,ve=[{key:"users",title:"Tổng người dùng",value:V(f.totalUsers),hint:`${V(f.activeUsers)} đang hoạt động (${he}% hoạt động)`,icon:e.jsx(d,{}),tone:"primary"},{key:"revenue",title:"Tổng doanh thu",value:`${V(f.totalRevenue)} đ`,hint:`${V(O.activeSubscriptions||0)} gói đang hoạt động`,icon:e.jsx(j,{}),tone:"purple"},{key:"blogs",title:"Blog chờ duyệt",value:V(C.pending||0),hint:`Tổng bài: ${V(ue)}`,icon:e.jsx(u,{}),tone:"amber",onClick:()=>y("/admin/blogs/pending")},{key:"ai",title:"Tương tác AI",value:V((null==ne?void 0:ne.totalMessages)||0),hint:`${V((null==ne?void 0:ne.totalUsers)||0)} người dùng AI`,icon:e.jsx(h,{}),tone:"teal"}],ge=[{key:"expense-users",title:"Số người dùng có chi tiêu",value:(null==ee?void 0:ee.totalUsers)||0,icon:e.jsx(d,{}),color:"#1890ff",loading:ae},{key:"budget-users",title:"Số người dùng có ngân sách",value:(null==te?void 0:te.totalUsers)||0,icon:e.jsx(d,{}),color:"#722ed1",loading:se},{key:"total-expenses",title:"Tổng số chi tiêu",value:(null==ee?void 0:ee.totalExpenses)||0,icon:e.jsx(x,{}),color:"#52c41a",loading:ae},{key:"total-budgets",title:"Tổng số ngân sách",value:(null==te?void 0:te.totalBudgets)||0,icon:e.jsx(p,{}),color:"#faad14",loading:se},{key:"ocr-jobs",title:"Tổng số lượt quét OCR",value:(null==le?void 0:le.totalJobs)||0,icon:e.jsx(v,{}),color:"#13c2c2",loading:ie},{key:"ocr-users",title:"Số người dùng dùng OCR",value:(null==le?void 0:le.totalUsers)||0,icon:e.jsx(D,{}),color:"#eb2f96",loading:ie},{key:"ai-messages",title:"Tổng tin nhắn AI",value:(null==ne?void 0:ne.totalMessages)||0,icon:e.jsx(h,{}),color:"#8B5CF6",loading:oe},{key:"ai-users",title:"Tổng người dùng AI",value:(null==ne?void 0:ne.totalUsers)||0,icon:e.jsx(g,{}),color:"#6366F1",loading:oe}],me=[{key:"activity-rate",title:"Tỷ lệ người dùng hoạt động",value:`${he}%`,description:`${V(f.activeUsers)} / ${V(f.totalUsers)} người dùng`,icon:e.jsx(g,{}),color:"#0EA5E9"},{key:"blogs-pending",title:"Blog chờ duyệt",value:V(C.pending||0),description:"Mở danh sách bài cần kiểm duyệt",icon:e.jsx(u,{}),color:"#F59E0B",onClick:()=>y("/admin/blogs/pending")},{key:"revenue-total",title:"Tổng doanh thu",value:`${V(f.totalRevenue)} đ`,description:`${V(O.activeSubscriptions||0)} gói đang hoạt động`,icon:e.jsx(j,{}),color:"#722ed1"},{key:"ai-ocr",title:"OCR & AI đang chạy",value:`${V((null==le?void 0:le.totalJobs)||0)} / ${V((null==ne?void 0:ne.totalMessages)||0)}`,description:`${V((null==ne?void 0:ne.totalUsers)||0)} người dùng AI`,icon:e.jsx(m,{}),color:"#10B981"}],je=Object.values(C).some(e=>Boolean(e));return e.jsxs("div",{className:"dashboard-shell",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsxs("div",{className:"dashboard-title",children:[e.jsx(H,{level:2,className:"dashboard-heading",children:"Admin Dashboard"}),e.jsx(F,{type:"secondary",children:"Ảnh tổng quan realtime các dịch vụ FEPA."})]}),e.jsx("div",{className:"kpi-grid",children:ve.map(a=>e.jsxs(b,{className:`kpi-card kpi-${a.tone}`,bordered:!1,onClick:a.onClick,hoverable:Boolean(a.onClick),children:[e.jsx("div",{className:"kpi-icon",children:a.icon}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx(F,{className:"kpi-label",children:a.title}),e.jsx("div",{className:"kpi-value",children:a.value}),a.hint&&e.jsx(F,{className:"kpi-hint",children:a.hint})]})]},a.key))})]}),e.jsxs(N,{gutter:[16,16],children:[e.jsxs(S,{xs:24,xl:16,children:[e.jsx(b,{title:"Thống kê Hệ thống",className:"section-card",children:e.jsx("div",{className:"stat-grid",children:ge.map(a=>e.jsx(b,{size:"small",className:"stat-card",bodyStyle:{padding:16},children:e.jsxs(R,{spinning:a.loading,indicator:K,children:[e.jsxs("div",{className:"stat-card__top",children:[e.jsx(F,{className:"stat-card__title",children:a.title}),e.jsx("div",{className:"stat-card__icon",style:{color:a.color},children:a.icon})]}),e.jsx("div",{className:"stat-card__value",style:{color:a.color},children:V(a.value)}),a.extra&&e.jsx(F,{type:"secondary",children:a.extra})]})},a.key))})}),e.jsxs("div",{className:"chart-grid",children:[e.jsx(b,{title:"Thống kê Blog theo trạng thái",loading:X,className:"section-card",children:e.jsx("div",{className:"chart-shell",children:je?e.jsx($,{width:"100%",height:"100%",children:e.jsxs(A,{children:[e.jsx(I,{data:[{name:"Đã duyệt",value:C.published||0,color:"#52c41a"},{name:"Chờ duyệt",value:C.pending||0,color:"#faad14"},{name:"Nháp",value:C.draft||0,color:"#1890ff"},{name:"Từ chối",value:C.rejected||0,color:"#ff4d4f"}].filter(e=>e.value>0),cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:a})=>`${e}: ${(100*a).toFixed(0)}%`,outerRadius:85,fill:"#8884d8",dataKey:"value",children:[{name:"Đã duyệt",value:C.published||0,color:"#52c41a"},{name:"Chờ duyệt",value:C.pending||0,color:"#faad14"},{name:"Nháp",value:C.draft||0,color:"#1890ff"},{name:"Từ chối",value:C.rejected||0,color:"#ff4d4f"}].filter(e=>e.value>0).map((a,t)=>e.jsx(B,{fill:a.color},`cell-${t}`))}),e.jsx(L,{}),e.jsx(_,{})]})}):e.jsx("div",{className:"chart-empty",children:e.jsx(F,{type:"secondary",children:"Chưa có dữ liệu blog"})})})}),e.jsx(b,{title:"Doanh thu theo gói Subscription",loading:W,className:"section-card",children:e.jsx("div",{className:"chart-shell",children:G.length>0?e.jsx($,{width:"100%",height:"100%",children:e.jsxs(w,{data:G,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"plan"}),e.jsx(q,{}),e.jsx(L,{formatter:(e,a,t)=>"revenue"===(null==t?void 0:t.dataKey)?[`${Number(e).toLocaleString()}đ`,"Doanh thu"]:[Number(e).toLocaleString(),a]}),e.jsx(_,{}),e.jsx(z,{dataKey:"revenue",fill:"#722ed1",name:"Doanh thu"}),e.jsx(z,{dataKey:"count",fill:"#1890ff",name:"Số lượng"})]})}):e.jsx("div",{className:"chart-empty",children:e.jsx(F,{type:"secondary",children:"Chưa có dữ liệu doanh thu"})})})})]})]}),e.jsx(S,{xs:24,xl:8,children:e.jsx(b,{title:"Tín hiệu nhanh",className:"section-card quick-card",children:e.jsx(U,{itemLayout:"horizontal",dataSource:me,renderItem:a=>e.jsxs(U.Item,{className:a.onClick?"clickable":"",onClick:a.onClick,children:[e.jsx(U.Item.Meta,{avatar:e.jsx(T,{style:{backgroundColor:a.color,color:"#fff"},icon:a.icon}),title:e.jsx("div",{className:"quick-title",children:a.title}),description:e.jsx(F,{type:"secondary",children:a.description})}),e.jsx("div",{className:"quick-value",children:a.value})]},a.key)})})})]})]})};export{J as default};
