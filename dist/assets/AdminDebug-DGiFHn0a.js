import{j as e}from"./vendor-CIDEvgjn.js";import{r as s}from"./react-YvAU7kAw.js";import{j as i}from"./index-CkXcCt97.js";import{I as n,_ as r,w as t,e as o,u as l,C as c,x as a,B as d,m as u,s as x,T as h,h as m,i as j,y as g,l as p}from"./antd-B4HmBe3_.js";import{e as v}from"./index-CWIbmrm_.js";import{R as f}from"./CloseCircleOutlined-BTaVCU99.js";import{s as k}from"./subscriptionAPI-D834kGML.js";import"./socket-CUkmNz_4.js";var b={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},y=function(e,i){return s.createElement(n,r({},e,{ref:i,icon:b}))},A=s.forwardRef(y),w={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M521.7 82c-152.5-.4-286.7 78.5-363.4 197.7-3.4 5.3.4 12.3 6.7 12.3h70.3c4.8 0 9.3-2.1 12.3-5.8 7-8.5 14.5-16.7 22.4-24.5 32.6-32.5 70.5-58.1 112.7-75.9 43.6-18.4 90-27.8 137.9-27.8 47.9 0 94.3 9.3 137.9 27.8 42.2 17.8 80.1 43.4 112.7 75.9 32.6 32.5 58.1 70.4 76 112.5C865.7 417.8 875 464.1 875 512c0 47.9-9.4 94.2-27.8 137.8-17.8 42.1-43.4 80-76 112.5s-70.5 58.1-112.7 75.9A352.8 352.8 0 01520.6 866c-47.9 0-94.3-9.4-137.9-27.8A353.84 353.84 0 01270 762.3c-7.9-7.9-15.3-16.1-22.4-24.5-3-3.7-7.6-5.8-12.3-5.8H165c-6.3 0-10.2 7-6.7 12.3C234.9 863.2 368.5 942 520.6 942c236.2 0 428-190.1 430.4-425.6C953.4 277.1 761.3 82.6 521.7 82zM395.02 624v-76h-314c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h314v-76c0-6.7 7.8-10.5 13-6.3l141.9 112a8 8 0 010 12.6l-141.9 112c-5.2 4.1-13 .4-13-6.3z"}}]},name:"login",theme:"outlined"},I=function(e,i){return s.createElement(n,r({},e,{ref:i,icon:w}))},S=s.forwardRef(I);const T=()=>localStorage.getItem("accessToken"),C=e=>{try{return i(e)}catch(s){return null}},z=e=>{try{const s=C(e);if(!s||!s.exp)return!0;const i=Date.now()/1e3;return s.exp<i}catch(s){return!0}},N=()=>{const e=T();if(!e)return{valid:!1,error:"No access token found in localStorage"};if(z(e))return{valid:!1,error:"Access token has expired",token:e};const s=C(e);return s?(e=>{try{const s=e||T();if(!s)return!1;const i=C(s);return!!i&&("ADMIN"===i.role||"admin"===i.role)}catch(s){return!1}})(e)?{valid:!0,token:e,user:s}:{valid:!1,error:"User does not have ADMIN role",token:e,user:s}:{valid:!1,error:"Failed to decode token",token:e}},R=()=>{const e=T();if(!e)return;C(e)},E=({compact:i=!1})=>{const[n,r]=s.useState(null),[x,h]=s.useState(null),m=()=>{const e=N();h(e);const s=(e=>{try{const s=e||T();return s?C(s):null}catch(s){return null}})(),i=localStorage.getItem("accessToken");r({exists:!!i,expired:!i||z(i),isAdmin:e.valid,userId:null==s?void 0:s.userId,email:null==s?void 0:s.email,role:null==s?void 0:s.role,expiresAt:(null==s?void 0:s.exp)?new Date(1e3*s.exp).toISOString():void 0,issuedAt:(null==s?void 0:s.iat)?new Date(1e3*s.iat).toISOString():void 0})};return s.useEffect(()=>{m()},[]),n?i?e.jsx(t,{message:e.jsxs(o,{children:[e.jsx("span",{children:"Token:"}),(null==x?void 0:x.valid)?e.jsx(l,{icon:e.jsx(v,{}),color:"success",children:"Valid Admin"}):e.jsx(l,{icon:e.jsx(f,{}),color:"error",children:n.exists?n.expired?"Expired":n.isAdmin?"Invalid":"Not Admin":"Missing"})]}),type:(null==x?void 0:x.valid)?"success":"error",showIcon:!0,closable:!0}):e.jsxs(c,{title:e.jsxs(o,{children:[e.jsx(A,{}),e.jsx("span",{children:"Authentication Status"}),(null==x?void 0:x.valid)?e.jsx(l,{icon:e.jsx(v,{}),color:"success",children:"Valid"}):e.jsx(l,{icon:e.jsx(f,{}),color:"error",children:"Invalid"})]}),extra:e.jsxs(o,{children:[e.jsx(d,{icon:e.jsx(u,{}),size:"small",onClick:m,children:"Refresh"}),e.jsx(d,{size:"small",onClick:R,children:"Console Log"})]}),size:"small",children:[x&&!x.valid&&e.jsx(t,{message:"Authentication Error",description:x.error,type:"error",showIcon:!0,style:{marginBottom:16}}),e.jsxs(a,{bordered:!0,size:"small",column:1,children:[e.jsx(a.Item,{label:"Token Exists",children:n.exists?e.jsx(l,{color:"success",children:"Yes"}):e.jsx(l,{color:"error",children:"No"})}),n.exists&&e.jsxs(e.Fragment,{children:[e.jsx(a.Item,{label:"Token Status",children:n.expired?e.jsx(l,{color:"error",children:"Expired"}):e.jsx(l,{color:"success",children:"Active"})}),e.jsx(a.Item,{label:"User ID",children:e.jsx("code",{children:n.userId||"N/A"})}),e.jsx(a.Item,{label:"Email",children:n.email||"N/A"}),e.jsx(a.Item,{label:"Role",children:e.jsx(l,{color:n.isAdmin?"blue":"default",children:n.role||"N/A"})}),e.jsx(a.Item,{label:"Admin Access",children:n.isAdmin?e.jsx(l,{icon:e.jsx(v,{}),color:"success",children:"Yes"}):e.jsx(l,{icon:e.jsx(f,{}),color:"error",children:"No"})}),n.issuedAt&&e.jsx(a.Item,{label:"Issued At",children:new Date(n.issuedAt).toLocaleString()}),n.expiresAt&&e.jsx(a.Item,{label:"Expires At",children:new Date(n.expiresAt).toLocaleString()})]})]}),!(null==x?void 0:x.valid)&&e.jsx(t,{message:"Troubleshooting Steps",description:e.jsxs("ul",{style:{paddingLeft:20,margin:0},children:[e.jsx("li",{children:"Check if you're logged in with an admin account"}),e.jsx("li",{children:"Try logging out and logging back in"}),e.jsx("li",{children:"Check browser console for detailed error messages"}),e.jsx("li",{children:"Verify backend is running and accessible"})]}),type:"info",showIcon:!0,style:{marginTop:16}})]}):null},{Title:D,Paragraph:F,Text:M}=h;function O(){const[i,n]=s.useState({}),[r,l]=s.useState(!1);s.useEffect(()=>{const e=N();e.valid||x.warning(`Token validation failed: ${e.error}`)},[]);const a=async(e,s)=>{try{const i=await s();n(s=>({...s,[e]:{success:!0,message:"Success",data:i}})),x.success(`${e}: Success`)}catch(i){n(s=>({...s,[e]:{success:!1,message:i.message||i.error||"Failed",data:i}})),x.error(`${e}: ${i.message||"Failed"}`)}};return e.jsxs("div",{style:{padding:24},children:[e.jsx(D,{level:2,children:"ðŸ”§ Admin Debug Panel"}),e.jsx(F,{type:"secondary",children:"CÃ´ng cá»¥ kiá»ƒm tra authentication vÃ  authorization issues cho admin endpoints"}),e.jsx(t,{message:"HÆ°á»›ng dáº«n sá»­ dá»¥ng",description:e.jsxs("ul",{style:{marginBottom:0,paddingLeft:20},children:[e.jsx("li",{children:"Kiá»ƒm tra token status bÃªn dÆ°á»›i Ä‘á»ƒ Ä‘áº£m báº£o báº¡n Ä‘Ã£ Ä‘Äƒng nháº­p vá»›i tÃ i khoáº£n ADMIN"}),e.jsx("li",{children:"Náº¿u token expired, hÃ£y Ä‘Äƒng xuáº¥t vÃ  Ä‘Äƒng nháº­p láº¡i"}),e.jsx("li",{children:'Cháº¡y "Test All Endpoints" Ä‘á»ƒ kiá»ƒm tra káº¿t ná»‘i vá»›i backend'}),e.jsx("li",{children:"Xem browser console (F12) Ä‘á»ƒ xem chi tiáº¿t lá»—i"})]}),type:"info",showIcon:!0,style:{marginBottom:24}}),e.jsxs(m,{gutter:[16,16],children:[e.jsx(j,{xs:24,lg:12,children:e.jsx(E,{})}),e.jsx(j,{xs:24,lg:12,children:e.jsx(c,{title:"Quick Actions",extra:e.jsx(d,{icon:e.jsx(u,{}),onClick:()=>window.location.reload(),size:"small",children:"Reload Page"}),children:e.jsxs(o,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsx(d,{type:"primary",block:!0,onClick:async()=>{l(!0),n({}),await a("Get Plans (Public)",()=>k.getPlans()),await a("Get Current Subscription (Auth)",()=>k.getCurrent()),await a("Get Subscription Stats (Admin)",()=>k.getStats()),await a("Get Revenue Totals (Admin)",()=>k.getRevenueTotals()),await a("Get Revenue Over Time (Admin)",()=>k.getRevenueOverTime({period:"daily",days:7})),await a("Get Revenue By Plan (Admin)",()=>k.getRevenueByPlan()),l(!1)},loading:r,icon:e.jsx(u,{}),children:"Test All Subscription Endpoints"}),e.jsx(d,{block:!0,onClick:R,children:"Log Token to Console"}),e.jsx(d,{block:!0,icon:e.jsx(g,{}),onClick:()=>{const e=T();e?(navigator.clipboard.writeText(e),x.success("Token copied to clipboard")):x.error("No token found")},children:"Copy Token to Clipboard"}),e.jsx(p,{}),e.jsx(d,{block:!0,danger:!0,icon:e.jsx(S,{}),onClick:()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),sessionStorage.removeItem("user"),x.success("Logged out - tokens cleared"),window.location.href="/login"},children:"Logout & Clear Tokens"})]})})})]}),Object.keys(i).length>0&&e.jsxs(e.Fragment,{children:[e.jsx(p,{}),e.jsx(c,{title:"Test Results",children:e.jsx(o,{direction:"vertical",style:{width:"100%"},size:"small",children:Object.entries(i).map(([s,i])=>e.jsx(t,{message:s,description:e.jsxs(e.Fragment,{children:[e.jsx(M,{strong:!0,children:"Status: "}),e.jsx(M,{type:i.success?"success":"danger",children:i.success?"âœ… Success":"âŒ Failed"}),e.jsx("br",{}),e.jsx(M,{strong:!0,children:"Message: "}),e.jsx(M,{children:i.message}),i.data&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx(M,{strong:!0,children:"Data: "}),e.jsxs(M,{code:!0,style:{fontSize:11},children:[JSON.stringify(i.data,null,2).substring(0,200),JSON.stringify(i.data).length>200?"...":""]})]})]}),type:i.success?"success":"error",showIcon:!0},s))})})]})]})}export{O as default};
