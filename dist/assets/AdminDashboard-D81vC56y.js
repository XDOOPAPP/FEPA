import{j as e}from"./vendor-CIDEvgjn.js";import{r as s,u as t}from"./react-YvAU7kAw.js";import{I as l,_ as a,d as i,T as n,C as r,h as o,i as d,S as c,u as x,p as h,j as u}from"./antd-Bnai4W4o.js";import{s as j}from"./subscriptionAPI-B0zzECmy.js";import{u as g,a as v,b as m,c as f}from"./queries-D4Exh2Yt.js";import{b as p}from"./blogAPI-DJm8VOYx.js";import{a as y}from"./adminApiService-lmFRPKPg.js";import{R as S,a as b,b as R,c as T,d as U}from"./index-C6bCr4XE.js";import{R as w}from"./ShoppingOutlined-2r5VS_Fb.js";import{R as k}from"./PieChartOutlined-57ONh_SH.js";import{R as A}from"./DollarOutlined-n-lS_avk.js";import{R as C,P as z,a as B,C as H,T as D,L as I,B as L,b as P,X as K,Y as N,c as O,d as E,e as q}from"./recharts-B4hB0_p6.js";import"./ocrAPI-tqSRKtv3.js";import"./aiAPI-Dv-e1IUL.js";import"./socket-CUkmNz_4.js";var F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 248H728l-32.4-90.8a32.07 32.07 0 00-30.2-21.2H358.6c-13.5 0-25.6 8.5-30.1 21.2L296 248H160c-44.2 0-80 35.8-80 80v456c0 44.2 35.8 80 80 80h704c44.2 0 80-35.8 80-80V328c0-44.2-35.8-80-80-80zm8 536c0 4.4-3.6 8-8 8H160c-4.4 0-8-3.6-8-8V328c0-4.4 3.6-8 8-8h186.7l17.1-47.8 22.9-64.2h250.5l22.9 64.2 17.1 47.8H864c4.4 0 8 3.6 8 8v456zM512 384c-88.4 0-160 71.6-160 160s71.6 160 160 160 160-71.6 160-160-71.6-160-160-160zm0 256c-53 0-96-43-96-96s43-96 96-96 96 43 96 96-43 96-96 96z"}}]},name:"camera",theme:"outlined"},M=function(e,t){return s.createElement(l,a({},e,{ref:t,icon:F}))},$=s.forwardRef(M);class V extends Error{}V.prototype.name="InvalidTokenError";const{Title:W,Text:_}=n,J=()=>{const l=t(),[a,n]=s.useState({totalUsers:0,totalRevenue:0,activeUsers:0}),[F,M]=s.useState({}),[V,J]=s.useState({totalRevenue:0}),[X,Y]=s.useState(!1),[G,Q]=s.useState([]),[Z,ee]=s.useState([]),[se,te]=s.useState(!1),{data:le,isLoading:ae}=g(),{data:ie,isLoading:ne}=v(),{data:re,isLoading:oe}=m(),{data:de,isLoading:ce}=f();s.useEffect(()=>{he(),ue(),xe()},[]);const xe=async()=>{te(!0);try{const e=await j.getRevenueByPlan(),s=Array.isArray(e)?e.map(e=>{var s;return{plan:(null==(s=e._id)?void 0:s.planName)||e.plan||"Unknown",revenue:e.totalRevenue||e.revenue||0,count:e.subscriptionCount||e.count||0}}):[];Q(s);const t=await y.getUsersOverTime("daily",30),l=(null==t?void 0:t.data)||[],a=Array.isArray(l)?l.map(e=>({date:i(e.date).format("DD/MM"),users:e.totalUsers||e.newUsers||0,newUsers:e.newUsers||0})):[];ee(a)}catch(e){Q([]),ee([])}finally{te(!1)}},he=async()=>{try{let s=0,t=0,l=0;try{const e=await y.getUserStats(),l=(null==e?void 0:e.data)||e||{};s=l.total||l.totalUsers||0,t=l.active||l.activeUsers||0}catch(e){}try{const e=await j.getRevenueTotals();if(e){l=(e.data||e).totalRevenue||0}}catch(e){}n({totalUsers:s,totalRevenue:l,activeUsers:t})}catch(e){n({totalUsers:0,totalRevenue:0,activeUsers:0})}},ue=async()=>{var e;Y(!0);try{const[s,t]=await Promise.allSettled([p.getStatusStats(),j.getRevenueTotals()]);if("fulfilled"===s.status&&s.value?M(s.value||{}):M({}),"fulfilled"===t.status&&t.value){const s=(null==(e=t.value)?void 0:e.data)||t.value||{totalRevenue:0};J(s)}else J({totalRevenue:0})}catch(s){M({}),J({totalRevenue:0})}finally{Y(!1)}};return e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(W,{level:2,children:"Admin Dashboard"}),!1,e.jsx(r,{title:"Thống kê Hệ thống",style:{marginBottom:"24px"},children:e.jsxs(o,{gutter:[16,16],children:[e.jsx(d,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(c,{spinning:ae,indicator:e.jsx(h,{style:{fontSize:24}}),children:e.jsx(x,{title:"Số người dùng có chi tiêu",value:(null==le?void 0:le.totalUsers)||0,prefix:e.jsx(S,{}),valueStyle:{color:"#1890ff"}})})})}),e.jsx(d,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(c,{spinning:ne,indicator:e.jsx(h,{style:{fontSize:24}}),children:e.jsx(x,{title:"Số người dùng có ngân sách",value:(null==ie?void 0:ie.totalUsers)||0,prefix:e.jsx(S,{}),valueStyle:{color:"#722ed1"}})})})}),e.jsx(d,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(c,{spinning:ae,indicator:e.jsx(h,{style:{fontSize:24}}),children:e.jsx(x,{title:"Tổng số chi tiêu",value:(null==le?void 0:le.totalExpenses)||0,prefix:e.jsx(w,{}),valueStyle:{color:"#52c41a"}})})})}),e.jsx(d,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(c,{spinning:ne,indicator:e.jsx(h,{style:{fontSize:24}}),children:e.jsx(x,{title:"Tổng số ngân sách",value:(null==ie?void 0:ie.totalBudgets)||0,prefix:e.jsx(k,{}),valueStyle:{color:"#faad14"}})})})}),e.jsx(d,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(c,{spinning:oe,indicator:e.jsx(h,{style:{fontSize:24}}),children:e.jsx(x,{title:"Tổng số lượt quét OCR",value:(null==re?void 0:re.totalJobs)||0,prefix:e.jsx(b,{}),valueStyle:{color:"#13c2c2"}})})})}),e.jsx(d,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(c,{spinning:oe,indicator:e.jsx(h,{style:{fontSize:24}}),children:e.jsx(x,{title:"Số người dùng dùng OCR",value:(null==re?void 0:re.totalUsers)||0,prefix:e.jsx($,{}),valueStyle:{color:"#eb2f96"}})})})}),e.jsx(d,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(c,{spinning:ce,indicator:e.jsx(h,{style:{fontSize:24}}),children:e.jsx(x,{title:"Tổng yêu cầu AI",value:(null==de?void 0:de.totalRequests)||0,prefix:e.jsx(R,{}),valueStyle:{color:"#8B5CF6"}})})})}),e.jsx(d,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(c,{spinning:ce,indicator:e.jsx(h,{style:{fontSize:24}}),children:e.jsx(x,{title:"Người dùng dùng AI",value:(null==de?void 0:de.totalUsers)||0,prefix:e.jsx(T,{}),valueStyle:{color:"#6366F1"}})})})})]})}),e.jsx(r,{title:"Thống kê hệ thống chính",style:{marginBottom:"24px"},children:e.jsxs(o,{gutter:[16,16],children:[e.jsx(d,{xs:24,sm:12,lg:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(x,{title:"Tổng người dùng",value:a.totalUsers,prefix:e.jsx(S,{}),valueStyle:{color:"#3f8600"}})})}),e.jsx(d,{xs:24,sm:12,lg:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(x,{title:"Người dùng hoạt động",value:a.activeUsers,prefix:e.jsx(T,{}),valueStyle:{color:"#1890ff"}})})}),e.jsx(d,{xs:24,sm:12,lg:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(x,{title:"Tổng doanh thu",value:a.totalRevenue,prefix:e.jsx(A,{}),suffix:"đ",valueStyle:{color:"#722ed1"}})})}),e.jsx(d,{xs:24,sm:12,lg:6,children:e.jsxs(r,{hoverable:!0,loading:X,onClick:()=>l("/admin/blogs/pending"),children:[e.jsx(x,{title:"Blog chờ duyệt",value:F.pending||0,prefix:e.jsx(U,{}),valueStyle:{color:"#F59E0B"}}),e.jsxs(u,{color:"blue",style:{marginTop:8},children:["Tổng: ",(F.pending||0)+(F.published||0)+(F.rejected||0)+(F.draft||0)]})]})})]})}),e.jsxs(o,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx(d,{xs:24,lg:8,children:e.jsx(r,{title:"Thống kê Blog theo trạng thái",loading:X,children:e.jsx("div",{style:{width:"100%",height:300,minHeight:300},children:Object.keys(F).length>0?e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(z,{children:[e.jsx(B,{data:[{name:"Đã duyệt",value:F.published||0,color:"#52c41a"},{name:"Chờ duyệt",value:F.pending||0,color:"#faad14"},{name:"Nháp",value:F.draft||0,color:"#1890ff"},{name:"Từ chối",value:F.rejected||0,color:"#ff4d4f"}].filter(e=>e.value>0),cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:s})=>`${e}: ${(100*s).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[{name:"Đã duyệt",value:F.published||0,color:"#52c41a"},{name:"Chờ duyệt",value:F.pending||0,color:"#faad14"},{name:"Nháp",value:F.draft||0,color:"#1890ff"},{name:"Từ chối",value:F.rejected||0,color:"#ff4d4f"}].filter(e=>e.value>0).map((s,t)=>e.jsx(H,{fill:s.color},`cell-${t}`))}),e.jsx(D,{}),e.jsx(I,{})]})}):e.jsx("div",{style:{textAlign:"center",padding:"80px 0"},children:e.jsx(_,{type:"secondary",children:"Chưa có dữ liệu blog"})})})})}),e.jsx(d,{xs:24,lg:8,children:e.jsx(r,{title:"Doanh thu theo gói Subscription",loading:se,children:e.jsx("div",{style:{width:"100%",height:300,minHeight:300},children:G.length>0?e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(L,{data:G,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"plan"}),e.jsx(N,{}),e.jsx(D,{formatter:e=>`${Number(e).toLocaleString()}đ`}),e.jsx(I,{}),e.jsx(O,{dataKey:"revenue",fill:"#722ed1",name:"Doanh thu"}),e.jsx(O,{dataKey:"count",fill:"#1890ff",name:"Số lượng"})]})}):e.jsx("div",{style:{textAlign:"center",padding:"80px 0"},children:e.jsx(_,{type:"secondary",children:"Chưa có dữ liệu doanh thu"})})})})}),e.jsx(d,{xs:24,lg:8,children:e.jsx(r,{title:"Tăng trưởng người dùng (30 ngày)",loading:se,children:e.jsx("div",{style:{width:"100%",height:300,minHeight:300},children:Z.length>0?e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(E,{data:Z,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"date"}),e.jsx(N,{}),e.jsx(D,{}),e.jsx(I,{}),e.jsx(q,{type:"monotone",dataKey:"users",stroke:"#1890ff",name:"Tổng người dùng",strokeWidth:2}),e.jsx(q,{type:"monotone",dataKey:"newUsers",stroke:"#52c41a",name:"Người dùng mới",strokeWidth:2})]})}):e.jsx("div",{style:{textAlign:"center",padding:"80px 0"},children:e.jsx(_,{type:"secondary",children:"Chưa có dữ liệu người dùng"})})})})})]})]})};export{J as default};
