import{j as e,c as t}from"./vendor-CIDEvgjn.js";import{u as i,r as s,k as l}from"./react-YvAU7kAw.js";import{b as a}from"./blogAPI-FLO4H6ir.js";import{F as n,u as r,S as d,f as o,B as c,s as h,q as u,j as g,e as x,H as p,Z as j,K as m,E as b}from"./antd-Ca0_LWAN.js";import{p as v}from"./index-DEkLrubD.js";import"./socket-CUkmNz_4.js";const y=({visible:t,blog:i,loading:s=!1,onConfirm:l,onCancel:a})=>{var h;const[u]=n.useForm(),g=()=>{u.resetFields(),a()};return e.jsx(r,{title:"Phê duyệt bài viết",open:t,onCancel:g,footer:[e.jsx(c,{onClick:g,disabled:s,children:"Hủy"},"cancel"),e.jsx(c,{type:"primary",onClick:async()=>{try{const e=await u.validateFields();l(e.note||void 0),u.resetFields()}catch(e){}},loading:s,children:"Phê duyệt"},"submit")],className:"approve-modal",children:e.jsx(d,{spinning:s,children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"blog-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tiêu đề:"})," ",i.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tác giả:"})," ",(null==(h=i.author)?void 0:h.name)||"N/A"]}),e.jsx("p",{className:"status-message",children:"✅ Bài viết sẽ được xuất bản"})]}),e.jsx(n,{form:u,layout:"vertical",children:e.jsx(n.Item,{name:"note",label:"Ghi chú (tùy chọn)",rules:[{max:500,message:"Ghi chú không được vượt quá 500 ký tự"}],children:e.jsx(o.TextArea,{placeholder:"Nhập ghi chú cho tác giả...",rows:4,disabled:s})})})]})})})},w=({visible:t,blog:i,loading:s=!1,onConfirm:l,onCancel:a})=>{var u;const[g]=n.useForm(),x=()=>{g.resetFields(),a()};return e.jsx(r,{title:"Từ chối bài viết",open:t,onCancel:x,footer:[e.jsx(c,{onClick:x,disabled:s,children:"Hủy"},"cancel"),e.jsx(c,{type:"primary",danger:!0,onClick:async()=>{try{const e=await g.validateFields();if(!e.reason||""===e.reason.trim())return void h.error("Vui lòng nhập lý do từ chối");l(e.reason),g.resetFields()}catch(e){}},loading:s,children:"Từ chối"},"submit")],className:"reject-modal",children:e.jsx(d,{spinning:s,children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"blog-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tiêu đề:"})," ",i.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tác giả:"})," ",(null==(u=i.author)?void 0:u.name)||"N/A"]}),e.jsx("p",{className:"status-message warning",children:"⚠️ Bài viết sẽ bị từ chối"})]}),e.jsx(n,{form:g,layout:"vertical",children:e.jsx(n.Item,{name:"reason",label:"Lý do từ chối",rules:[{required:!0,message:"Vui lòng nhập lý do từ chối"},{max:500,message:"Lý do không được vượt quá 500 ký tự"},{min:10,message:"Lý do phải có ít nhất 10 ký tự"}],children:e.jsx(o.TextArea,{placeholder:"Nhập lý do từ chối bài viết...",rows:5,disabled:s})})})]})})})},C=()=>{const l=i(),[n,r]=s.useState(!1),[d,b]=s.useState(!1),[v,C]=s.useState(!1),[N,f]=s.useState(null),[k,L]=s.useState("pending"),[T,B]=s.useState(""),{data:S,isLoading:I,refetch:A}=t({queryKey:["allBlogsForAdminReview"],queryFn:()=>a.getAllBlogsForAdminReview()}),z=((null==S?void 0:S.data)||[]).filter(e=>{var t;const i="ALL"===k||e.status===k,s=""===T||e.title.toLowerCase().includes(T.toLowerCase())||(null==(t=e.author)?void 0:t.toLowerCase().includes(T.toLowerCase()))||e.userId.toLowerCase().includes(T.toLowerCase());return i&&s}),F=s.useCallback(async e=>{if(N){r(!0);try{await a.approveBlog(N.id,{note:e}),h.success("Bài viết đã được phê duyệt"),b(!1),f(null),A()}catch(t){h.error("Lỗi khi phê duyệt bài viết")}finally{r(!1)}}},[N,A]),D=s.useCallback(async e=>{if(N){r(!0);try{await a.rejectBlog(N.id,{rejectionReason:e}),h.success("Bài viết đã bị từ chối"),C(!1),f(null),A()}catch(t){h.error("Lỗi khi từ chối bài viết")}finally{r(!1)}}},[N,A]),K=[{title:"Tiêu đề",dataIndex:"title",key:"title",width:300,ellipsis:!0,render:t=>e.jsx("span",{className:"blog-title",children:t})},{title:"Tác giả",dataIndex:"author",key:"author",width:150,render:(e,t)=>e||t.userId||"N/A"},{title:"Ngày gửi",dataIndex:"createdAt",key:"createdAt",width:150,render:e=>new Date(e).toLocaleDateString("vi-VN")},{title:"Trạng thái",dataIndex:"status",key:"status",width:100,render:t=>{const{label:i,color:s}={pending:{label:"Chờ duyệt",color:"orange"},draft:{label:"Nháp",color:"default"},published:{label:"Đã xuất bản",color:"green"},rejected:{label:"Bị từ chối",color:"red"}}[t]||{label:t,color:"default"};return e.jsx(g,{color:s,children:i})}},{title:"Hành động",key:"actions",width:250,render:(t,i)=>e.jsxs(x,{size:"small",wrap:!0,children:[e.jsx(c,{type:"primary",size:"small",icon:e.jsx(p,{}),onClick:()=>{l(`/admin/blogs/${i.id}`)},children:"Xem"}),e.jsx(c,{type:"primary",size:"small",icon:e.jsx(j,{}),style:{backgroundColor:"#52c41a"},onClick:()=>(f(i),void b(!0)),disabled:"draft"===i.status||"published"===i.status||"rejected"===i.status,title:"draft"===i.status?"Không thể duyệt bài viết nháp":"published"===i.status?"Bài viết đã duyệt":"rejected"===i.status?"Bài viết đã bị từ chối":"Duyệt bài viết",children:"Duyệt"}),e.jsx(c,{type:"primary",danger:!0,size:"small",icon:e.jsx(m,{}),onClick:()=>(f(i),void C(!0)),disabled:"draft"===i.status||"published"===i.status||"rejected"===i.status,title:"draft"===i.status?"Không thể từ chối bài viết nháp":"published"===i.status?"Bài viết đã duyệt":"rejected"===i.status?"Bài viết đã bị từ chối":"Từ chối bài viết",children:"Từ chối"})]})}];return e.jsxs("div",{className:"blogs-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Quản lý Bài viết"}),e.jsxs("p",{className:"subtitle",children:["Tổng cộng: ",z.length," bài viết"]})]}),e.jsxs("div",{style:{marginBottom:"16px",display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap"},children:[e.jsx(o,{placeholder:"Tìm kiếm theo tiêu đề, tác giả...",value:T,onChange:e=>B(e.target.value),style:{width:"300px"},allowClear:!0}),e.jsxs("select",{value:k,onChange:e=>L(e.target.value),style:{padding:"6px 12px",borderRadius:"4px",border:"1px solid #d9d9d9",cursor:"pointer",fontSize:"14px"},children:[e.jsx("option",{value:"pending",children:"Cần duyệt"}),e.jsx("option",{value:"ALL",children:"Tất cả"})]})]}),e.jsx("div",{className:"blogs-table-container",children:e.jsx(u,{columns:K,dataSource:z,loading:I,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`Tổng ${e} bài viết`}})}),N&&e.jsxs(e.Fragment,{children:[e.jsx(y,{visible:d,blog:N,loading:n,onConfirm:F,onCancel:()=>{b(!1),f(null)}}),e.jsx(w,{visible:v,blog:N,loading:n,onConfirm:D,onCancel:()=>{C(!1),f(null)}})]})]})},N=()=>{const l=i(),[n,r]=s.useState(""),{data:d,isLoading:h}=t({queryKey:["publishedBlogs"],queryFn:()=>a.getPublishedBlogs()}),x=((null==d?void 0:d.data)||[]).filter(e=>{var t;return""===n||e.title.toLowerCase().includes(n.toLowerCase())||(null==(t=e.author)?void 0:t.toLowerCase().includes(n.toLowerCase()))||e.userId.toLowerCase().includes(n.toLowerCase())}),j=[{title:"Tiêu đề",dataIndex:"title",key:"title",width:300,ellipsis:!0,render:t=>e.jsx("span",{className:"blog-title",children:t})},{title:"Tác giả",dataIndex:"author",key:"author",width:150,render:(e,t)=>e||t.userId||"N/A"},{title:"Ngày xuất bản",dataIndex:"publishedAt",key:"publishedAt",width:150,render:e=>e?new Date(e).toLocaleDateString("vi-VN"):"N/A"},{title:"Trạng thái",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(g,{color:"green",children:"published"===t?"Đã xuất bản":t})},{title:"Hành động",key:"actions",width:100,render:(t,i)=>e.jsx(c,{type:"primary",size:"small",icon:e.jsx(p,{}),onClick:()=>{l(`/admin/blogs/${i.id}`)},children:"Xem"})}];return e.jsxs("div",{className:"blogs-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Bài viết đã xuất bản"}),e.jsxs("p",{className:"subtitle",children:["Tổng cộng: ",x.length," bài viết"]})]}),e.jsx("div",{style:{marginBottom:"16px",display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap"},children:e.jsx(o,{placeholder:"Tìm kiếm theo tiêu đề, tác giả...",value:n,onChange:e=>r(e.target.value),style:{width:"300px"},allowClear:!0})}),e.jsx("div",{className:"blogs-table-container",children:e.jsx(u,{columns:j,dataSource:x,loading:h,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`Tổng ${e} bài viết`}})})]})},f=()=>{const l=i(),[n,r]=s.useState(""),{data:d,isLoading:h}=t({queryKey:["rejectedBlogs"],queryFn:()=>a.getRejectedBlogs()}),x=((null==d?void 0:d.data)||[]).filter(e=>{var t;return""===n||e.title.toLowerCase().includes(n.toLowerCase())||(null==(t=e.author)?void 0:t.toLowerCase().includes(n.toLowerCase()))||e.userId.toLowerCase().includes(n.toLowerCase())}),j=[{title:"Tiêu đề",dataIndex:"title",key:"title",width:300,ellipsis:!0,render:t=>e.jsx("span",{className:"blog-title",children:t})},{title:"Tác giả",dataIndex:"author",key:"author",width:150,render:(e,t)=>e||t.userId||"N/A"},{title:"Lý do từ chối",dataIndex:"rejectionReason",key:"rejectionReason",width:300,ellipsis:!0,render:e=>e||"Không có lý do"},{title:"Ngày từ chối",dataIndex:"updatedAt",key:"updatedAt",width:150,render:e=>new Date(e).toLocaleDateString("vi-VN")},{title:"Trạng thái",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(g,{color:"red",children:"rejected"===t?"Bị từ chối":t})},{title:"Hành động",key:"actions",width:100,render:(t,i)=>e.jsx(c,{type:"primary",size:"small",icon:e.jsx(p,{}),onClick:()=>{l(`/admin/blogs/${i.id}`)},children:"Xem"})}];return e.jsxs("div",{className:"blogs-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Bài viết bị từ chối"}),e.jsxs("p",{className:"subtitle",children:["Tổng cộng: ",x.length," bài viết"]})]}),e.jsx("div",{style:{marginBottom:"16px",display:"flex",gap:"12px",alignItems:"center",flexWrap:"wrap"},children:e.jsx(o,{placeholder:"Tìm kiếm theo tiêu đề, tác giả...",value:n,onChange:e=>r(e.target.value),style:{width:"300px"},allowClear:!0})}),e.jsx("div",{className:"blogs-table-container",children:e.jsx(u,{columns:j,dataSource:x,loading:h,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`Tổng ${e} bài viết`}})})]})},k=()=>{var n;const{id:r}=l(),o=i(),[u,p]=s.useState(!1),[C,N]=s.useState(!1),[f,k]=s.useState(!1),{data:L,isLoading:T,refetch:B}=t({queryKey:["blogDetail",r],queryFn:()=>r?a.getBlogDetail(r):Promise.reject("No ID"),enabled:!!r});if(!r)return e.jsx(b,{description:"Không tìm thấy bài viết"});if(T)return e.jsx(d,{size:"large",style:{display:"flex",justifyContent:"center",marginTop:"50px"}});if(!L)return e.jsx(b,{description:"Bài viết không tồn tại"});return e.jsxs("div",{className:"blog-detail-page",children:[e.jsxs("div",{className:"blog-detail-header",children:[e.jsx(c,{type:"text",icon:e.jsx(v,{}),onClick:()=>o(-1),style:{marginBottom:"16px"},children:"Quay lại"}),e.jsxs("div",{className:"blog-detail-title-section",children:[e.jsx("h1",{children:L.title}),e.jsxs("div",{className:"blog-detail-meta",children:[e.jsxs("span",{children:["Tác giả: ",(null==(n=L.author)?void 0:n.name)||"N/A"]}),e.jsxs("span",{children:["Trạng thái: ",(t=>{const i={draft:{color:"default",label:"Nháp"},pending:{color:"orange",label:"Chờ duyệt"},published:{color:"green",label:"Đã xuất bản"},rejected:{color:"red",label:"Bị từ chối"}}[t]||{color:"default",label:t};return e.jsx(g,{color:i.color,children:i.label})})(L.status)]}),e.jsxs("span",{children:["Ngày tạo: ",new Date(L.createdAt).toLocaleDateString("vi-VN")]}),L.publishedAt&&e.jsxs("span",{children:["Ngày xuất bản: ",new Date(L.publishedAt).toLocaleDateString("vi-VN")]})]})]})]}),e.jsxs("div",{className:"blog-detail-content",children:[L.thumbnailUrl&&e.jsx("div",{className:"blog-thumbnail",children:e.jsx("img",{src:L.thumbnailUrl,alt:L.title})}),e.jsx("div",{className:"blog-body",children:L.content?e.jsx("div",{dangerouslySetInnerHTML:{__html:L.content}}):e.jsx("p",{style:{color:"#999",fontStyle:"italic"},children:"Không có nội dung"})}),L.images&&L.images.length>0&&e.jsxs("div",{className:"blog-images",children:[e.jsx("h3",{children:"Hình ảnh"}),e.jsx("div",{className:"images-grid",children:L.images.map((t,i)=>e.jsx("div",{className:"image-item",children:e.jsx("img",{src:t,alt:`Hình ${i+1}`})},i))})]})]}),"pending"===L.status&&e.jsxs("div",{className:"blog-detail-actions",children:[e.jsx("h3",{children:"Hành động"}),e.jsxs(x,{children:[e.jsx(c,{type:"primary",icon:e.jsx(j,{}),size:"large",style:{backgroundColor:"#52c41a"},onClick:()=>N(!0),children:"Phê duyệt bài viết"}),e.jsx(c,{type:"primary",danger:!0,icon:e.jsx(m,{}),size:"large",onClick:()=>k(!0),children:"Từ chối bài viết"})]})]}),"rejected"===L.status&&L.rejectionReason&&e.jsxs("div",{className:"blog-rejection-info",children:[e.jsx("h3",{children:"Lý do từ chối"}),e.jsx("p",{children:L.rejectionReason})]}),e.jsx(y,{visible:C,blog:L,loading:u,onConfirm:async e=>{p(!0);try{await a.approveBlog(L.id,{note:e}),h.success("Bài viết đã được phê duyệt"),N(!1),B()}catch(t){h.error("Lỗi khi phê duyệt bài viết")}finally{p(!1)}},onCancel:()=>N(!1)}),e.jsx(w,{visible:f,blog:L,loading:u,onConfirm:async e=>{p(!0);try{await a.rejectBlog(L.id,{reason:e}),h.success("Bài viết đã bị từ chối"),k(!1),B()}catch(t){h.error("Lỗi khi từ chối bài viết")}finally{p(!1)}},onCancel:()=>k(!1)})]})};export{k as BlogDetail,C as PendingBlogs,N as PublishedBlogs,f as RejectedBlogs};
