import{j as e,c as i}from"./vendor-CIDEvgjn.js";import{u as s,r as t,k as a}from"./react-YvAU7kAw.js";import{b as l}from"./blogAPI-DuLMQIgS.js";import{F as n,y as r,S as d,f as c,B as o,s as h,w as g,u as x,e as u,K as m,a1 as j,O as p,E as b}from"./antd-BDFa4u8q.js";import{q as y}from"./index-eiZvAwCW.js";import"./socket-CUkmNz_4.js";const v=({visible:i,blog:s,loading:t=!1,onConfirm:a,onCancel:l})=>{var h;const[g]=n.useForm(),x=()=>{g.resetFields(),l()};return e.jsx(r,{title:"Phê duyệt bài viết",open:i,onCancel:x,footer:[e.jsx(o,{onClick:x,disabled:t,children:"Hủy"},"cancel"),e.jsx(o,{type:"primary",onClick:async()=>{try{const e=await g.validateFields();a(e.note||void 0),g.resetFields()}catch(e){}},loading:t,children:"Phê duyệt"},"submit")],className:"approve-modal",children:e.jsx(d,{spinning:t,children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"blog-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tiêu đề:"})," ",s.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tác giả:"})," ",(null==(h=s.author)?void 0:h.name)||"N/A"]}),e.jsx("p",{className:"status-message",children:"✅ Bài viết sẽ được xuất bản"})]}),e.jsx(n,{form:g,layout:"vertical",children:e.jsx(n.Item,{name:"note",label:"Ghi chú (tùy chọn)",rules:[{max:500,message:"Ghi chú không được vượt quá 500 ký tự"}],children:e.jsx(c.TextArea,{placeholder:"Nhập ghi chú cho tác giả...",rows:4,disabled:t})})})]})})})},N=({visible:i,blog:s,loading:t=!1,onConfirm:a,onCancel:l})=>{var g;const[x]=n.useForm(),u=()=>{x.resetFields(),l()};return e.jsx(r,{title:"Từ chối bài viết",open:i,onCancel:u,footer:[e.jsx(o,{onClick:u,disabled:t,children:"Hủy"},"cancel"),e.jsx(o,{type:"primary",danger:!0,onClick:async()=>{try{const e=await x.validateFields();if(!e.reason||""===e.reason.trim())return void h.error("Vui lòng nhập lý do từ chối");a(e.reason),x.resetFields()}catch(e){}},loading:t,children:"Từ chối"},"submit")],className:"reject-modal",children:e.jsx(d,{spinning:t,children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"blog-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tiêu đề:"})," ",s.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tác giả:"})," ",(null==(g=s.author)?void 0:g.name)||"N/A"]}),e.jsx("p",{className:"status-message warning",children:"⚠️ Bài viết sẽ bị từ chối"})]}),e.jsx(n,{form:x,layout:"vertical",children:e.jsx(n.Item,{name:"reason",label:"Lý do từ chối",rules:[{required:!0,message:"Vui lòng nhập lý do từ chối"},{max:500,message:"Lý do không được vượt quá 500 ký tự"},{min:10,message:"Lý do phải có ít nhất 10 ký tự"}],children:e.jsx(c.TextArea,{placeholder:"Nhập lý do từ chối bài viết...",rows:5,disabled:t})})})]})})})},k=()=>{const a=s(),[n,r]=t.useState(!1),[d,c]=t.useState(!1),[b,y]=t.useState(!1),[k,w]=t.useState(null),{data:f,isLoading:C,refetch:T}=i({queryKey:["pendingBlogs"],queryFn:()=>l.getPendingBlogs()}),B=(null==f?void 0:f.data)||[],S=t.useCallback(async e=>{if(k){r(!0);try{await l.approveBlog(k.id,{note:e}),h.success("Bài viết đã được phê duyệt"),c(!1),w(null),T()}catch(i){h.error("Lỗi khi phê duyệt bài viết")}finally{r(!1)}}},[k,T]),A=t.useCallback(async e=>{if(k){r(!0);try{await l.rejectBlog(k.id,{reason:e}),h.success("Bài viết đã bị từ chối"),y(!1),w(null),T()}catch(i){h.error("Lỗi khi từ chối bài viết")}finally{r(!1)}}},[k,T]),L=[{title:"Tiêu đề",dataIndex:"title",key:"title",width:300,ellipsis:!0,render:i=>e.jsx("span",{className:"blog-title",children:i})},{title:"Tác giả",dataIndex:["author","name"],key:"author",width:150,render:e=>e||"N/A"},{title:"Ngày gửi",dataIndex:"createdAt",key:"createdAt",width:150,render:e=>new Date(e).toLocaleDateString("vi-VN")},{title:"Trạng thái",dataIndex:"status",key:"status",width:100,render:i=>e.jsx(x,{color:"orange",children:"pending"===i?"Chờ duyệt":i})},{title:"Hành động",key:"actions",width:250,render:(i,s)=>e.jsxs(u,{size:"small",wrap:!0,children:[e.jsx(o,{type:"primary",size:"small",icon:e.jsx(m,{}),onClick:()=>{a(`/admin/blogs/${s.id}`)},children:"Xem"}),e.jsx(o,{type:"primary",size:"small",icon:e.jsx(j,{}),style:{backgroundColor:"#52c41a"},onClick:()=>(w(s),void c(!0)),children:"Duyệt"}),e.jsx(o,{type:"primary",danger:!0,size:"small",icon:e.jsx(p,{}),onClick:()=>(w(s),void y(!0)),children:"Từ chối"})]})}];return e.jsxs("div",{className:"blogs-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Bài viết chờ duyệt"}),e.jsxs("p",{className:"subtitle",children:["Tổng cộng: ",B.length," bài viết"]})]}),e.jsx("div",{className:"blogs-table-container",children:e.jsx(g,{columns:L,dataSource:B,loading:C,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`Tổng ${e} bài viết`}})}),k&&e.jsxs(e.Fragment,{children:[e.jsx(v,{visible:d,blog:k,loading:n,onConfirm:S,onCancel:()=>{c(!1),w(null)}}),e.jsx(N,{visible:b,blog:k,loading:n,onConfirm:A,onCancel:()=>{y(!1),w(null)}})]})]})},w=()=>{const t=s(),{data:a,isLoading:n}=i({queryKey:["publishedBlogs"],queryFn:()=>l.getPublishedBlogs()}),r=(null==a?void 0:a.data)||[],d=[{title:"Tiêu đề",dataIndex:"title",key:"title",width:300,ellipsis:!0,render:i=>e.jsx("span",{className:"blog-title",children:i})},{title:"Tác giả",dataIndex:["author","name"],key:"author",width:150,render:e=>e||"N/A"},{title:"Ngày xuất bản",dataIndex:"publishedAt",key:"publishedAt",width:150,render:e=>e?new Date(e).toLocaleDateString("vi-VN"):"N/A"},{title:"Trạng thái",dataIndex:"status",key:"status",width:100,render:i=>e.jsx(x,{color:"green",children:"published"===i?"Đã xuất bản":i})},{title:"Hành động",key:"actions",width:100,render:(i,s)=>e.jsx(o,{type:"primary",size:"small",icon:e.jsx(m,{}),onClick:()=>{t(`/admin/blogs/${s.id}`)},children:"Xem"})}];return e.jsxs("div",{className:"blogs-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Bài viết đã xuất bản"}),e.jsxs("p",{className:"subtitle",children:["Tổng cộng: ",r.length," bài viết"]})]}),e.jsx("div",{className:"blogs-table-container",children:e.jsx(g,{columns:d,dataSource:r,loading:n,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`Tổng ${e} bài viết`}})})]})},f=()=>{const t=s(),{data:a,isLoading:n}=i({queryKey:["rejectedBlogs"],queryFn:()=>l.getRejectedBlogs()}),r=(null==a?void 0:a.data)||[],d=[{title:"Tiêu đề",dataIndex:"title",key:"title",width:300,ellipsis:!0,render:i=>e.jsx("span",{className:"blog-title",children:i})},{title:"Tác giả",dataIndex:["author","name"],key:"author",width:150,render:e=>e||"N/A"},{title:"Lý do từ chối",dataIndex:"rejectionReason",key:"rejectionReason",width:300,ellipsis:!0,render:e=>e||"Không có lý do"},{title:"Ngày từ chối",dataIndex:"updatedAt",key:"updatedAt",width:150,render:e=>new Date(e).toLocaleDateString("vi-VN")},{title:"Trạng thái",dataIndex:"status",key:"status",width:100,render:i=>e.jsx(x,{color:"red",children:"rejected"===i?"Bị từ chối":i})},{title:"Hành động",key:"actions",width:100,render:(i,s)=>e.jsx(o,{type:"primary",size:"small",icon:e.jsx(m,{}),onClick:()=>{t(`/admin/blogs/${s.id}`)},children:"Xem"})}];return e.jsxs("div",{className:"blogs-page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Bài viết bị từ chối"}),e.jsxs("p",{className:"subtitle",children:["Tổng cộng: ",r.length," bài viết"]})]}),e.jsx("div",{className:"blogs-table-container",children:e.jsx(g,{columns:d,dataSource:r,loading:n,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:e=>`Tổng ${e} bài viết`}})})]})},C=()=>{var n;const{id:r}=a(),c=s(),[g,m]=t.useState(!1),[k,w]=t.useState(!1),[f,C]=t.useState(!1),{data:T,isLoading:B,refetch:S}=i({queryKey:["blogDetail",r],queryFn:()=>r?l.getBlogDetail(r):Promise.reject("No ID"),enabled:!!r});if(!r)return e.jsx(b,{description:"Không tìm thấy bài viết"});if(B)return e.jsx(d,{size:"large",style:{display:"flex",justifyContent:"center",marginTop:"50px"}});if(!T)return e.jsx(b,{description:"Bài viết không tồn tại"});return e.jsxs("div",{className:"blog-detail-page",children:[e.jsxs("div",{className:"blog-detail-header",children:[e.jsx(o,{type:"text",icon:e.jsx(y,{}),onClick:()=>c(-1),style:{marginBottom:"16px"},children:"Quay lại"}),e.jsxs("div",{className:"blog-detail-title-section",children:[e.jsx("h1",{children:T.title}),e.jsxs("div",{className:"blog-detail-meta",children:[e.jsxs("span",{children:["Tác giả: ",(null==(n=T.author)?void 0:n.name)||"N/A"]}),e.jsxs("span",{children:["Trạng thái: ",(i=>{const s={draft:{color:"default",label:"Nháp"},pending:{color:"orange",label:"Chờ duyệt"},published:{color:"green",label:"Đã xuất bản"},rejected:{color:"red",label:"Bị từ chối"}}[i]||{color:"default",label:i};return e.jsx(x,{color:s.color,children:s.label})})(T.status)]}),e.jsxs("span",{children:["Ngày tạo: ",new Date(T.createdAt).toLocaleDateString("vi-VN")]}),T.publishedAt&&e.jsxs("span",{children:["Ngày xuất bản: ",new Date(T.publishedAt).toLocaleDateString("vi-VN")]})]})]})]}),e.jsxs("div",{className:"blog-detail-content",children:[T.thumbnailUrl&&e.jsx("div",{className:"blog-thumbnail",children:e.jsx("img",{src:T.thumbnailUrl,alt:T.title})}),e.jsx("div",{className:"blog-body",children:T.content?e.jsx("div",{dangerouslySetInnerHTML:{__html:T.content}}):e.jsx("p",{style:{color:"#999",fontStyle:"italic"},children:"Không có nội dung"})}),T.images&&T.images.length>0&&e.jsxs("div",{className:"blog-images",children:[e.jsx("h3",{children:"Hình ảnh"}),e.jsx("div",{className:"images-grid",children:T.images.map((i,s)=>e.jsx("div",{className:"image-item",children:e.jsx("img",{src:i,alt:`Hình ${s+1}`})},s))})]})]}),"pending"===T.status&&e.jsxs("div",{className:"blog-detail-actions",children:[e.jsx("h3",{children:"Hành động"}),e.jsxs(u,{children:[e.jsx(o,{type:"primary",icon:e.jsx(j,{}),size:"large",style:{backgroundColor:"#52c41a"},onClick:()=>w(!0),children:"Phê duyệt bài viết"}),e.jsx(o,{type:"primary",danger:!0,icon:e.jsx(p,{}),size:"large",onClick:()=>C(!0),children:"Từ chối bài viết"})]})]}),"rejected"===T.status&&T.rejectionReason&&e.jsxs("div",{className:"blog-rejection-info",children:[e.jsx("h3",{children:"Lý do từ chối"}),e.jsx("p",{children:T.rejectionReason})]}),e.jsx(v,{visible:k,blog:T,loading:g,onConfirm:async e=>{m(!0);try{await l.approveBlog(T.id,{note:e}),h.success("Bài viết đã được phê duyệt"),w(!1),S()}catch(i){h.error("Lỗi khi phê duyệt bài viết")}finally{m(!1)}},onCancel:()=>w(!1)}),e.jsx(N,{visible:f,blog:T,loading:g,onConfirm:async e=>{m(!0);try{await l.rejectBlog(T.id,{reason:e}),h.success("Bài viết đã bị từ chối"),C(!1),S()}catch(i){h.error("Lỗi khi từ chối bài viết")}finally{m(!1)}},onCancel:()=>C(!1)})]})};export{C as BlogDetail,k as PendingBlogs,w as PublishedBlogs,f as RejectedBlogs};
