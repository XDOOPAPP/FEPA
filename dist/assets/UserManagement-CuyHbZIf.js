import{j as e}from"./vendor-CIDEvgjn.js";import{r as t}from"./react-YvAU7kAw.js";import{I as a,_ as n,T as l,e as s,B as i,O as r,R as c,P as o,W as d,C as h,F as u,w as m,d as g,f as x,j as p,x as f,y as v,g as j,u as y,G as k,s as w}from"./antd-BDFa4u8q.js";import{g as S,e as b,c as A,j as C}from"./index-eiZvAwCW.js";import{e as I}from"./exportUtils-CGhWYdho.js";import"./socket-CUkmNz_4.js";const T=async e=>{const t={};return(null==e?void 0:e.search)&&(t.search=e.search),(null==e?void 0:e.status)&&"ALL"!==e.status&&(t.status=e.status),(null==e?void 0:e.role)&&"ALL"!==e.role&&(t.role=e.role),(null==e?void 0:e.verified)&&"ALL"!==e.verified&&(t.verified=e.verified),(null==e?void 0:e.page)&&(t.page=e.page),(null==e?void 0:e.pageSize)&&(t.pageSize=e.pageSize),await S.get("/auth/users",{params:t})},z=async e=>await S.patch(`/auth/users/${e}/deactivate`),M=async e=>await S.patch(`/auth/users/${e}/reactivate`),L=async e=>await S.delete(`/auth/users/${e}`);var H={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},N=function(e,l){return t.createElement(a,n({},e,{ref:l,icon:H}))},E=t.forwardRef(N),B={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M608 112c-167.9 0-304 136.1-304 304 0 70.3 23.9 135 63.9 186.5l-41.1 41.1-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-44.9 44.9-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-65.3 65.3a8.03 8.03 0 000 11.3l42.3 42.3c3.1 3.1 8.2 3.1 11.3 0l253.6-253.6A304.06 304.06 0 00608 720c167.9 0 304-136.1 304-304S775.9 112 608 112zm161.2 465.2C726.2 620.3 668.9 644 608 644c-60.9 0-118.2-23.7-161.2-66.8-43.1-43-66.8-100.3-66.8-161.2 0-60.9 23.7-118.2 66.8-161.2 43-43.1 100.3-66.8 161.2-66.8 60.9 0 118.2 23.7 161.2 66.8 43.1 43 66.8 100.3 66.8 161.2 0 60.9-23.7 118.2-66.8 161.2z"}}]},name:"key",theme:"outlined"},V=function(e,l){return t.createElement(a,n({},e,{ref:l,icon:B}))},D=t.forwardRef(V),Y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v68c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-68c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zm-40 376H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"unlock",theme:"outlined"},R=function(e,l){return t.createElement(a,n({},e,{ref:l,icon:Y}))},U=t.forwardRef(R);const{Text:F}=l,X=({selectedCount:t,onClearSelection:a,actions:n=[],loading:l=!1})=>{if(0===t)return null;return e.jsxs("div",{style:{position:"fixed",bottom:24,left:"50%",transform:"translateX(-50%)",zIndex:1e3,background:"#fff",padding:"12px 24px",borderRadius:8,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",gap:16},children:[e.jsx(b,{style:{color:"#1890ff",fontSize:20}}),e.jsxs(F,{strong:!0,children:["Đã chọn ",t," ",1===t?"item":"items"]}),e.jsxs(s,{children:[n.map(a=>{const n=e.jsx(i,{icon:a.icon,danger:a.danger,loading:l,onClick:a.onClick,children:a.label},a.key);return a.confirm?e.jsx(o,{title:a.confirmTitle||`Bạn có chắc chắn muốn ${a.label.toLowerCase()} ${t} items?`,onConfirm:a.onClick,okText:"Có",cancelText:"Không",okButtonProps:{danger:a.danger},children:e.jsx(i,{icon:a.icon,danger:a.danger,loading:l,children:a.label})},a.key):n}),e.jsx(i,{icon:e.jsx(r,{}),onClick:a,disabled:l,children:"Bỏ chọn"})]})]})},$=t=>({key:"delete",label:"Xóa",icon:e.jsx(c,{}),danger:!0,confirm:!0,confirmTitle:"Bạn có chắc chắn muốn xóa các items đã chọn?",onClick:t}),O=t=>({key:"export",label:"Export",icon:e.jsx(E,{}),onClick:t}),P=({type:t="text",rows:a=3,active:n=!0,loading:l=!0,children:s})=>{if(!l)return e.jsx(e.Fragment,{children:s});switch(t){case"card":return e.jsx(h,{children:e.jsx(d,{active:n,avatar:!0,paragraph:{rows:4}})});case"table":return e.jsx("div",{style:{padding:"20px"},children:Array.from({length:a}).map((t,a)=>e.jsx(d,{active:n,paragraph:{rows:0},style:{marginBottom:"16px"}},a))});case"form":return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(d.Input,{active:n,style:{width:"100%",marginBottom:"16px"}}),e.jsx(d.Input,{active:n,style:{width:"100%",marginBottom:"16px"}}),e.jsx(d.Input,{active:n,style:{width:"100%",marginBottom:"16px"}}),e.jsx(d.Button,{active:n,style:{width:"100px",marginTop:"16px"}})]});case"list":return e.jsx("div",{children:Array.from({length:a}).map((t,a)=>e.jsx(h,{style:{marginBottom:"16px"},children:e.jsx(d,{active:n,avatar:!0,paragraph:{rows:2}})},a))});default:return e.jsx(d,{active:n,paragraph:{rows:a}})}},q=({rows:t=5,loading:a=!0,children:n})=>e.jsx(P,{type:"table",rows:t,loading:a,children:n}),{Title:K}=l,_=()=>{const[a,n]=t.useState([]),[l,r]=t.useState(!1),[d,S]=t.useState(null),[b]=u.useForm(),[H,N]=t.useState(!0),[E,B]=t.useState({status:"ALL",role:"ALL",verified:"ALL",page:1,pageSize:10}),[V,Y]=t.useState(0),{selectedIds:R,selectedItems:F,isAllSelected:P,isSomeSelected:_,toggleItem:G,toggleAll:Q,deselectAll:W,isSelected:J}=function({items:e,getItemId:a}){const[n,l]=t.useState(new Set),s=Array.isArray(e)?e:[],i=t.useMemo(()=>s.map(a),[s,a]),r=t.useMemo(()=>i.length>0&&i.every(e=>n.has(e)),[i,n]),c=t.useMemo(()=>n.size>0&&!r,[n.size,r]),o=t.useMemo(()=>s.filter(e=>n.has(a(e))),[s,n,a]),d=t.useCallback(e=>{l(t=>new Set(t).add(e))},[]),h=t.useCallback(e=>{l(t=>{const a=new Set(t);return a.delete(e),a})},[]),u=t.useCallback(e=>{l(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),m=t.useCallback(()=>{l(new Set(i))},[i]),g=t.useCallback(()=>{l(new Set)},[]),x=t.useCallback(()=>{r?g():m()},[r,m,g]),p=t.useCallback(e=>n.has(e),[n]);return{selectedIds:n,selectedItems:o,isAllSelected:r,isSomeSelected:c,selectedCount:n.size,selectItem:d,deselectItem:h,toggleItem:u,selectAll:m,deselectAll:g,toggleAll:x,isSelected:p}}({items:a,getItemId:e=>e.id});t.useEffect(()=>{Z()},[]);const Z=async()=>{N(!0);try{const e=await T(E)||{},t=(Array.isArray(e.data)?e.data:e.users||e.items||[]).map(e=>{const t=(e.role||"USER").toUpperCase();return{id:e.id||e._id,email:e.email,fullName:e.fullName||e.name,role:t,status:e.isActive?"active":"locked",phone:e.phoneNumber||e.phone,createdAt:e.createdAt,lastLogin:e.lastLogin||e.createdAt}});n(t),Y(e.total||t.length)}catch(e){n([])}finally{N(!1)}},ee=e=>{B(t=>({...t,...e,page:1})),Z()},te=[{title:e.jsx(j,{checked:P,indeterminate:_,onChange:Q}),key:"checkbox",width:50,render:(t,a)=>e.jsx(j,{checked:J(a.id),onChange:()=>G(a.id)})},{title:"Email",dataIndex:"email",key:"email",sorter:(e,t)=>e.email.localeCompare(t.email)},{title:"Họ tên",dataIndex:"fullName",key:"fullName",sorter:(e,t)=>e.fullName.localeCompare(t.fullName)},{title:"Số điện thoại",dataIndex:"phone",key:"phone"},{title:"Vai trò",dataIndex:"role",key:"role",render:t=>{const a="SUPER_ADMIN"===t,n="ADMIN"===t;return e.jsx(y,{color:a?"gold":n?"red":"blue",children:a?"Super Admin":n?"Admin":"User"})},filters:[{text:"Super Admin",value:"SUPER_ADMIN"},{text:"Admin",value:"ADMIN"},{text:"User",value:"USER"}],onFilter:(e,t)=>t.role===e},{title:"Trạng thái",dataIndex:"status",key:"status",render:t=>e.jsx(y,{color:"active"===t?"green":"red",children:"active"===t?"Hoạt động":"Đã khóa"}),filters:[{text:"Hoạt động",value:"active"},{text:"Đã khóa",value:"locked"}],onFilter:(e,t)=>t.status===e},{title:"Ngày tạo",dataIndex:"createdAt",key:"createdAt",render:e=>g(e).format("DD/MM/YYYY HH:mm"),sorter:(e,t)=>g(e.createdAt).unix()-g(t.createdAt).unix()},{title:"Đăng nhập cuối",dataIndex:"lastLogin",key:"lastLogin",render:e=>g(e).format("DD/MM/YYYY HH:mm"),sorter:(e,t)=>g(e.lastLogin).unix()-g(t.lastLogin).unix()},{title:"Thao tác",key:"action",fixed:"right",width:280,render:(t,a)=>e.jsxs(s,{size:"small",wrap:!0,style:{padding:"4px",border:"1px solid #f0f0f0",borderRadius:"6px",background:"#fafafa",display:"inline-flex",gap:"4px"},children:[e.jsx(i,{type:"text",icon:e.jsx(k,{}),onClick:()=>(e=>{S(e),b.setFieldsValue(e),r(!0)})(a),size:"small",style:{color:"#1890ff"},children:"Sửa"}),e.jsx(i,{type:"text",icon:"active"===a.status?e.jsx(C,{}):e.jsx(U,{}),onClick:()=>(e=>{(async()=>{try{const t="active"===e.status?"locked":"active";"locked"===t?await z(e.id):await M(e.id),await Z(),w.success("locked"===t?"Đã khóa người dùng":"Đã mở khóa người dùng")}catch(t){w.error("Thao tác thất bại")}})()})(a),size:"small",style:{color:"#faad14"},children:"active"===a.status?"Khóa":"Mở"}),e.jsx(i,{type:"text",icon:e.jsx(D,{}),onClick:()=>(e=>{v.confirm({title:"Xác nhận reset mật khẩu",content:`Bạn có chắc muốn reset mật khẩu cho ${e.fullName}?`,onOk:()=>{w.info("Tính năng reset mật khẩu sẽ được bổ sung sau")}})})(a),size:"small",style:{color:"#52c41a"},children:"Reset MK"}),e.jsx(o,{title:"Xác nhận xóa",description:"Bạn có chắc muốn xóa người dùng này?",onConfirm:()=>{return e=a.id,void v.confirm({title:"Xác nhận xóa",content:"Bạn có chắc muốn xóa người dùng này?",onOk:async()=>{try{await L(e),await Z(),w.success("Xóa người dùng thành công")}catch(t){w.error("Xóa user thất bại")}}});var e},okText:"Xóa",cancelText:"Hủy",children:e.jsx(i,{type:"text",danger:!0,icon:e.jsx(c,{}),size:"small",children:"Xóa"})})]})}];return e.jsxs("div",{children:[e.jsx(h,{title:e.jsxs(K,{level:3,children:[e.jsx(A,{})," Quản lý người dùng"]}),extra:e.jsxs(s,{wrap:!0,children:[e.jsx(x.Search,{allowClear:!0,placeholder:"Tìm theo email/họ tên",onSearch:e=>{B(t=>({...t,search:e,page:1})),Z()},style:{width:260}}),e.jsx(p,{value:E.status,onChange:e=>ee({status:e}),style:{width:140},options:[{label:"Tất cả",value:"ALL"},{label:"Hoạt động",value:"ACTIVE"},{label:"Đã khóa",value:"INACTIVE"}]}),e.jsx(p,{value:E.role,onChange:e=>ee({role:e}),style:{width:140},options:[{label:"Tất cả",value:"ALL"},{label:"User",value:"USER"},{label:"Admin",value:"ADMIN"}]}),e.jsx(p,{value:E.verified,onChange:e=>ee({verified:e}),style:{width:160},options:[{label:"Tất cả",value:"ALL"},{label:"Đã xác thực",value:"VERIFIED"},{label:"Chưa xác thực",value:"UNVERIFIED"}]}),e.jsx(i,{type:"primary",icon:e.jsx(f,{}),onClick:()=>{S(null),b.resetFields(),r(!0)},children:"Thêm"})]}),children:e.jsx(q,{rows:5,loading:H,children:e.jsx(m,{dataSource:a,columns:te,rowKey:"id",pagination:{current:E.page,pageSize:E.pageSize,total:V,showSizeChanger:!0,showTotal:e=>`Tổng ${e} người dùng`},onChange:e=>{const{current:t,pageSize:a}=e;B(e=>({...e,page:t,pageSize:a})),Z()},scroll:{x:1200}})})}),e.jsx(X,{selectedCount:R.size,onClearSelection:W,actions:[$(()=>{v.confirm({title:"Xác nhận xóa nhiều",content:`Bạn có chắc muốn xóa ${R.size} người dùng đã chọn?`,onOk:async()=>{try{const e=Array.from(R);await Promise.all(e.map(e=>L(e))),W(),await Z(),w.success(`Đã xóa ${e.length} người dùng`)}catch(e){w.error("Xóa nhiều thất bại")}}})}),O(()=>{const e=F.map(e=>({Email:e.email,"Họ tên":e.fullName,"Số điện thoại":e.phone||"","Vai trò":"ADMIN"===e.role?"Admin":"User","Trạng thái":"active"===e.status?"Hoạt động":"Đã khóa","Ngày tạo":g(e.createdAt).format("DD/MM/YYYY HH:mm"),"Đăng nhập cuối":g(e.lastLogin).format("DD/MM/YYYY HH:mm")}));I(e,{filename:"users-export"}),w.success(`Đã export ${R.size} người dùng`)})]}),e.jsx(v,{title:d?"Sửa người dùng":"Thêm người dùng mới",open:l,onOk:async()=>{try{await b.validateFields(),w.info("Tính năng tạo/cập nhật người dùng sẽ được bổ sung sau"),r(!1),b.resetFields(),await Z()}catch(e){w.error("Thao tác thất bại")}},onCancel:()=>{r(!1),b.resetFields()},width:600,okText:d?"Cập nhật":"Thêm",cancelText:"Hủy",children:e.jsxs(u,{form:b,layout:"vertical",style:{marginTop:"20px"},children:[e.jsx(u.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Vui lòng nhập email"},{type:"email",message:"Email không hợp lệ"}],children:e.jsx(x,{prefix:e.jsx(A,{}),placeholder:"example@email.com"})}),e.jsx(u.Item,{label:"Họ tên",name:"fullName",rules:[{required:!0,message:"Vui lòng nhập họ tên"}],children:e.jsx(x,{placeholder:"Nguyễn Văn A"})}),e.jsx(u.Item,{label:"Số điện thoại",name:"phone",children:e.jsx(x,{placeholder:"0123456789"})}),e.jsx(u.Item,{label:"Vai trò",name:"role",rules:[{required:!0,message:"Vui lòng chọn vai trò"}],children:e.jsxs(p,{placeholder:"Chọn vai trò",children:[e.jsx(p.Option,{value:"user",children:"User"}),e.jsx(p.Option,{value:"admin",children:"Admin"})]})}),!d&&e.jsx(u.Item,{label:"Mật khẩu",name:"password",rules:[{required:!0,message:"Vui lòng nhập mật khẩu"},{min:6,message:"Mật khẩu phải có ít nhất 6 ký tự"}],children:e.jsx(x.Password,{placeholder:"Nhập mật khẩu"})})]})})]})};export{_ as default};
