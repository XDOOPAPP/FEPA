import{j as e}from"./vendor-CIDEvgjn.js";import{r as a}from"./react-YvAU7kAw.js";import{R as s,d as t,b as l,X as n,Y as r,T as i,L as o,e as c,B as d,c as h}from"./recharts-OKR9gfyr.js";import{s as u}from"./subscriptionAPI-BwKWqfSG.js";import{L as j,m as x}from"./index-DEkLrubD.js";import{e as m}from"./exportUtils-CGhWYdho.js";import{I as p,_ as v,e as y,w as g,B as f,O as b,h as S,i as w,C as B,p as E,E as R}from"./antd-Ca0_LWAN.js";import{R as k}from"./ShoppingOutlined-BlmXKr7L.js";import"./socket-CUkmNz_4.js";var N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M917 211.1l-199.2 24c-6.6.8-9.4 8.9-4.7 13.6l59.3 59.3-226 226-101.8-101.7c-6.3-6.3-16.4-6.2-22.6 0L100.3 754.1a8.03 8.03 0 000 11.3l45 45.2c3.1 3.1 8.2 3.1 11.3 0L433.3 534 535 635.7c6.3 6.2 16.4 6.2 22.6 0L829 364.5l59.3 59.3a8.01 8.01 0 0013.6-4.7l24-199.2c.7-5.1-3.7-9.5-8.9-8.8z"}}]},name:"rise",theme:"outlined"},C=function(e,s){return a.createElement(p,v({},e,{ref:s,icon:N}))},A=a.forwardRef(C);function D(){const[p,v]=a.useState(!1),[N,C]=a.useState("daily"),[D,L]=a.useState(30),[T,K]=a.useState({totalRevenue:0}),[_,O]=a.useState([]),[P,$]=a.useState([]),F=async()=>{v(!0);try{const[e,a,s]=await Promise.all([u.getRevenueTotals(),u.getRevenueOverTime({period:N,days:D}),u.getRevenueByPlan()]);K((null==e?void 0:e.data)||e||{totalRevenue:0});const t=(null==a?void 0:a.data)||a||[],l=Array.isArray(t)?t.map(e=>({date:e._id||e.date,revenue:e.totalRevenue||e.revenue||0})):[];O(l);const n=s||[],r=Array.isArray(n)?n.map(e=>{var a;return{plan:(null==(a=e._id)?void 0:a.planName)||e.plan||"Unknown",revenue:e.totalRevenue||e.revenue||0,count:e.subscriptionCount||e.count||0}}):[];$(r)}catch(e){K({totalRevenue:0}),O([]),$([])}finally{v(!1)}};a.useEffect(()=>{F()},[N,D]);const I=((null==_?void 0:_.length)||0)>0||((null==P?void 0:P.length)||0)>0;return e.jsx(j,{loading:p,children:e.jsxs("div",{style:{padding:24},children:[e.jsxs(y,{style:{width:"100%",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("h2",{style:{margin:0},children:[e.jsx(x,{})," Doanh thu & Subscriptions"]}),e.jsxs(y,{children:[e.jsx(g,{value:N,onChange:e=>C(e),options:[{label:"Theo ngày",value:"daily"},{label:"Theo tuần",value:"weekly"},{label:"Theo tháng",value:"monthly"}]}),e.jsx(g,{value:D,onChange:e=>L(e),options:[{label:"7 ngày",value:7},{label:"30 ngày",value:30},{label:"90 ngày",value:90},{label:"1 năm",value:365}]}),e.jsx(f,{icon:e.jsx(b,{}),onClick:F,children:"Làm mới"}),e.jsx(f,{onClick:()=>m(_.map(e=>({"Ngày":e.date,Doanh_thu:e.revenue})),{filename:`revenue-${N}-${D}`}),children:"Export CSV"})]})]}),e.jsxs(S,{gutter:16,style:{marginBottom:16},children:[e.jsx(w,{span:6,children:e.jsx(B,{className:"shadow-card",children:e.jsx(E,{title:"Tổng doanh thu",value:T.totalRevenue||0,prefix:e.jsx(x,{style:{color:"#10B981"}}),precision:0,suffix:"đ",valueStyle:{color:"#10B981"}})})}),e.jsx(w,{span:6,children:e.jsx(B,{className:"shadow-card",children:e.jsx(E,{title:"Subscription đang hoạt động",value:T.activeSubscriptions||0,prefix:e.jsx(A,{style:{color:"#0EA5E9"}}),valueStyle:{color:"#0EA5E9"}})})}),e.jsx(w,{span:6,children:e.jsx(B,{className:"shadow-card",children:e.jsx(E,{title:"Đã hủy",value:T.cancelledSubscriptions||0,prefix:e.jsx(b,{style:{color:"#F59E0B"}}),valueStyle:{color:"#F59E0B"}})})}),e.jsx(w,{span:6,children:e.jsx(B,{className:"shadow-card",children:e.jsx(E,{title:"Tổng số subscription",value:T.totalSubscriptions||0,prefix:e.jsx(k,{style:{color:"#64748B"}}),valueStyle:{color:"#64748B"}})})})]}),I?e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:14,children:e.jsx(B,{className:"shadow-card",title:"Doanh thu theo thời gian",children:e.jsx("div",{style:{height:320},children:e.jsx(s,{width:"100%",height:"100%",children:e.jsxs(t,{data:_,children:[e.jsx(l,{strokeDasharray:"3 3"}),e.jsx(n,{dataKey:"date"}),e.jsx(r,{}),e.jsx(i,{formatter:e=>`${Number(e).toLocaleString()}đ`}),e.jsx(o,{}),e.jsx(c,{type:"monotone",dataKey:"revenue",name:"Doanh thu",stroke:"#10B981",strokeWidth:3})]})})})})}),e.jsx(w,{span:10,children:e.jsx(B,{className:"shadow-card",title:"Doanh thu theo gói",children:e.jsx("div",{style:{height:320},children:e.jsx(s,{width:"100%",height:"100%",children:e.jsxs(d,{data:P,children:[e.jsx(l,{strokeDasharray:"3 3"}),e.jsx(n,{dataKey:"plan"}),e.jsx(r,{}),e.jsx(i,{formatter:e=>Number(e).toLocaleString()}),e.jsx(o,{}),e.jsx(h,{dataKey:"revenue",name:"Doanh thu (đ)",fill:"#0EA5E9",radius:[6,6,0,0]}),e.jsx(h,{dataKey:"count",name:"Số lượng",fill:"#10B981",radius:[6,6,0,0]})]})})})})})]}):e.jsx(B,{children:e.jsx(R,{description:"Chưa có dữ liệu doanh thu"})})]})})}export{D as default};
