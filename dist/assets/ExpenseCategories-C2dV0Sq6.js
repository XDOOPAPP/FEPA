import{j as e}from"./vendor-CIDEvgjn.js";import{r as t}from"./react-YvAU7kAw.js";import{F as a,e as n,B as s,x as i,f as r,Z as c,m as d,d as l,C as o,w as h,H as m,k as u,s as p,u as x,G as j,P as y,R as g}from"./antd-BDFa4u8q.js";import{g as T,A as v,L as C,o as A}from"./index-eiZvAwCW.js";import{e as f}from"./exportUtils-CGhWYdho.js";import"./socket-CUkmNz_4.js";const k=async e=>{const t=await T.get(v.CATEGORIES.LIST,{params:e?{search:e}:void 0}),a=t.data||t;return Array.isArray(a)?a:(null==a?void 0:a.data)&&Array.isArray(a.data)?a.data:[]},w=async e=>{const t=await T.post(v.CATEGORIES.CREATE,e),a=t.data||t;return(null==a?void 0:a.data)||a},E=async(e,t)=>{const a=await T.patch(v.CATEGORIES.UPDATE(e),t),n=a.data||a;return(null==n?void 0:n.data)||n},Y=async e=>{await T.delete(v.CATEGORIES.DELETE(e))};function S(){const[T,v]=t.useState([]),[S,I]=t.useState(""),[M,D]=t.useState(!1),[b,L]=t.useState(!1),[F,R]=t.useState(null),[G,P]=t.useState(!1),[V]=a.useForm(),X=async()=>{D(!0);try{const e=await k(S||void 0);v(e)}catch(e){v([])}finally{D(!1)}};t.useEffect(()=>{X()},[]);const B=t.useMemo(()=>{if(!S)return T;const e=S.toLowerCase();return T.filter(t=>{var a,n;return(null==(a=t.name)?void 0:a.toLowerCase().includes(e))||(null==(n=t.description)?void 0:n.toLowerCase().includes(e))})},[T,S]),O=[{title:"Tên",dataIndex:"name",key:"name"},{title:"Mô tả",dataIndex:"description",key:"description",ellipsis:!0},{title:"Trạng thái",dataIndex:"isActive",key:"isActive",render:t=>t?e.jsx(x,{color:"green",children:"Đang dùng"}):e.jsx(x,{color:"default",children:"Tắt"})},{title:"Tạo lúc",dataIndex:"createdAt",key:"createdAt",render:e=>e?l(e).format("DD/MM/YYYY"):"-"},{title:"Cập nhật",dataIndex:"updatedAt",key:"updatedAt",render:e=>e?l(e).format("DD/MM/YYYY"):"-"},{title:"Thao tác",key:"actions",width:150,render:(t,a)=>e.jsxs(n,{children:[e.jsx(s,{type:"link",size:"small",icon:e.jsx(j,{}),onClick:()=>(e=>{R(e),V.setFieldsValue({name:e.name,description:e.description,isActive:e.isActive??!0}),L(!0)})(a),children:"Sửa"}),e.jsx(y,{title:"Xóa danh mục",description:"Bạn có chắc muốn xóa danh mục này?",onConfirm:()=>(async e=>{var t,a;try{await Y(e),p.success("Xóa danh mục thành công"),X()}catch(n){p.error((null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Xóa danh mục thất bại")}})(a.id),okText:"Xóa",cancelText:"Hủy",okButtonProps:{danger:!0},children:e.jsx(s,{type:"link",size:"small",danger:!0,icon:e.jsx(g,{}),children:"Xóa"})})]})}];return e.jsx(C,{loading:M,children:e.jsxs("div",{style:{padding:24},children:[e.jsxs(n,{style:{width:"100%",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("h2",{style:{margin:0},children:[e.jsx(A,{})," Danh mục chi tiêu"]}),e.jsxs(n,{children:[e.jsx(s,{type:"primary",icon:e.jsx(i,{}),onClick:()=>{R(null),V.resetFields(),V.setFieldsValue({isActive:!0}),L(!0)},children:"Thêm mới"}),e.jsx(r,{placeholder:"Tìm theo tên/mô tả",value:S,onChange:e=>I(e.target.value),onPressEnter:X,style:{width:260},prefix:e.jsx(c,{})}),e.jsx(s,{type:"primary",icon:e.jsx(c,{}),onClick:X,children:"Tìm"}),e.jsx(s,{icon:e.jsx(d,{}),onClick:()=>{I(""),X()},children:"Làm mới"}),e.jsx(s,{onClick:()=>f(B.map(e=>({Ten:e.name,Mo_ta:e.description||"",Trang_thai:e.isActive?"Đang dùng":"Tắt",Tao_luc:e.createdAt?l(e.createdAt).format("DD/MM/YYYY"):"",Cap_nhat:e.updatedAt?l(e.updatedAt).format("DD/MM/YYYY"):""})),{filename:"expense-categories"}),children:"Export CSV"})]})]}),e.jsx(o,{children:e.jsx(h,{dataSource:B,columns:O,rowKey:e=>e.id||e.name,pagination:{pageSize:10}})}),e.jsx(m,{title:F?"Chỉnh sửa danh mục":"Thêm danh mục mới",open:b,onClose:()=>L(!1),width:480,footer:e.jsxs(n,{style:{float:"right"},children:[e.jsx(s,{onClick:()=>L(!1),children:"Hủy"}),e.jsx(s,{type:"primary",onClick:()=>V.submit(),loading:G,children:F?"Cập nhật":"Tạo mới"})]}),children:e.jsxs(a,{form:V,layout:"vertical",onFinish:async e=>{var t,a;P(!0);try{F?(await E(F.id,e),p.success("Cập nhật danh mục thành công")):(await w(e),p.success("Tạo danh mục thành công")),L(!1),X()}catch(n){p.error((null==(a=null==(t=n.response)?void 0:t.data)?void 0:a.message)||"Thao tác thất bại")}finally{P(!1)}},children:[e.jsx(a.Item,{name:"name",label:"Tên danh mục",rules:[{required:!0,message:"Vui lòng nhập tên danh mục"}],children:e.jsx(r,{placeholder:"Ví dụ: Ăn uống, Di chuyển"})}),e.jsx(a.Item,{name:"description",label:"Mô tả",children:e.jsx(r.TextArea,{rows:3,placeholder:"Mô tả chi tiết về danh mục (tùy chọn)"})}),e.jsx(a.Item,{name:"isActive",label:"Trạng thái",valuePropName:"checked",children:e.jsx(u,{checkedChildren:"Đang dùng",unCheckedChildren:"Tắt"})})]})})]})})}export{S as default};
