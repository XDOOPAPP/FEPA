import{j as e}from"./vendor-CIDEvgjn.js";import{r as s}from"./react-YvAU7kAw.js";import{R as a,L as t,C as l,X as n,Y as i,T as r,b as o,B as c,a as d,c as h}from"./recharts-Bl_pMUXE.js";import{s as u}from"./subscriptionAPI-D6fKhPBi.js";import{L as j,m as x}from"./index-eiZvAwCW.js";import{e as m}from"./exportUtils-CGhWYdho.js";import{I as p,_ as v,e as g,j as y,B as f,m as b,h as w,i as S,C as R,t as C,E as k}from"./antd-BDFa4u8q.js";import{R as B}from"./ShoppingOutlined-CRgbW1Qy.js";import"./socket-CUkmNz_4.js";var T={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M917 211.1l-199.2 24c-6.6.8-9.4 8.9-4.7 13.6l59.3 59.3-226 226-101.8-101.7c-6.3-6.3-16.4-6.2-22.6 0L100.3 754.1a8.03 8.03 0 000 11.3l45 45.2c3.1 3.1 8.2 3.1 11.3 0L433.3 534 535 635.7c6.3 6.2 16.4 6.2 22.6 0L829 364.5l59.3 59.3a8.01 8.01 0 0013.6-4.7l24-199.2c.7-5.1-3.7-9.5-8.9-8.8z"}}]},name:"rise",theme:"outlined"},D=function(e,a){return s.createElement(p,v({},e,{ref:a,icon:T}))},N=s.forwardRef(D);function E(){const[p,v]=s.useState(!1),[T,D]=s.useState("daily"),[E,L]=s.useState(30),[K,$]=s.useState({totalRevenue:0}),[P,A]=s.useState([]),[I,O]=s.useState([]),_=async()=>{v(!0);try{const[e,s,a]=await Promise.all([u.getRevenueTotals(),u.getRevenueOverTime({period:T,days:E}),u.getRevenueByPlan()]);$((null==e?void 0:e.data)||e||{totalRevenue:0}),A((null==s?void 0:s.data)||s||[]),O(a||[])}catch(e){$({totalRevenue:0}),A([]),O([])}finally{v(!1)}};s.useEffect(()=>{_()},[T,E]);const z=((null==P?void 0:P.length)||0)>0||((null==I?void 0:I.length)||0)>0;return e.jsx(j,{loading:p,children:e.jsxs("div",{style:{padding:24},children:[e.jsxs(g,{style:{width:"100%",justifyContent:"space-between",marginBottom:16},children:[e.jsxs("h2",{style:{margin:0},children:[e.jsx(x,{})," Doanh thu & Subscriptions"]}),e.jsxs(g,{children:[e.jsx(y,{value:T,onChange:e=>D(e),options:[{label:"Theo ngày",value:"daily"},{label:"Theo tuần",value:"weekly"},{label:"Theo tháng",value:"monthly"}]}),e.jsx(y,{value:E,onChange:e=>L(e),options:[{label:"7 ngày",value:7},{label:"30 ngày",value:30},{label:"90 ngày",value:90},{label:"1 năm",value:365}]}),e.jsx(f,{icon:e.jsx(b,{}),onClick:_,children:"Làm mới"}),e.jsx(f,{onClick:()=>m(P.map(e=>({"Ngày":e.date,Doanh_thu:e.revenue})),{filename:`revenue-${T}-${E}`}),children:"Export CSV"})]})]}),e.jsxs(w,{gutter:16,style:{marginBottom:16},children:[e.jsx(S,{span:6,children:e.jsx(R,{className:"shadow-card",children:e.jsx(C,{title:"Tổng doanh thu",value:K.totalRevenue||0,prefix:e.jsx(x,{style:{color:"var(--success)"}}),precision:0})})}),e.jsx(S,{span:6,children:e.jsx(R,{className:"shadow-card",children:e.jsx(C,{title:"Subscription đang hoạt động",value:K.activeSubscriptions||0,prefix:e.jsx(N,{style:{color:"var(--primary)"}})})})}),e.jsx(S,{span:6,children:e.jsx(R,{className:"shadow-card",children:e.jsx(C,{title:"Đã hủy",value:K.cancelledSubscriptions||0,prefix:e.jsx(b,{style:{color:"var(--warning)"}})})})}),e.jsx(S,{span:6,children:e.jsx(R,{className:"shadow-card",children:e.jsx(C,{title:"Tổng số subscription",value:K.totalSubscriptions||0,prefix:e.jsx(B,{style:{color:"var(--info)"}})})})})]}),z?e.jsxs(w,{gutter:16,children:[e.jsx(S,{span:14,children:e.jsx(R,{className:"shadow-card",title:"Doanh thu theo thời gian",children:e.jsx("div",{style:{height:320},children:e.jsx(a,{width:"100%",height:"100%",children:e.jsxs(t,{data:P,children:[e.jsx(l,{strokeDasharray:"3 3"}),e.jsx(n,{dataKey:"date"}),e.jsx(i,{}),e.jsx(r,{formatter:e=>`${e}đ`}),e.jsx(o,{type:"monotone",dataKey:"revenue",stroke:"#10B981",strokeWidth:3})]})})})})}),e.jsx(S,{span:10,children:e.jsx(R,{className:"shadow-card",title:"Doanh thu theo gói",children:e.jsx("div",{style:{height:320},children:e.jsx(a,{width:"100%",height:"100%",children:e.jsxs(c,{data:I,children:[e.jsx(l,{strokeDasharray:"3 3"}),e.jsx(n,{dataKey:"plan"}),e.jsx(i,{}),e.jsx(r,{formatter:e=>`${e}đ`}),e.jsx(d,{}),e.jsx(h,{dataKey:"revenue",name:"Doanh thu",fill:"#0EA5E9",radius:[6,6,0,0]}),e.jsx(h,{dataKey:"count",name:"Số lượt",fill:"#10B981",radius:[6,6,0,0]})]})})})})})]}):e.jsx(R,{children:e.jsx(k,{description:"Chưa có dữ liệu doanh thu"})})]})})}export{E as default};
