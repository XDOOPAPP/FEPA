import{j as e}from"./vendor-CIDEvgjn.js";import{r as t,u as s}from"./react-YvAU7kAw.js";import{I as a,_ as l,d as n,T as i,C as r,h as o,i as c,S as d,t as u,o as x,u as h,v as m,e as j,A as g}from"./antd-BDFa4u8q.js";import{s as v}from"./subscriptionAPI-D6fKhPBi.js";import{u as f,a as p,b as y,c as S}from"./queries-ClOP8Q9q.js";import{b}from"./blogAPI-DuLMQIgS.js";import{R as T,a as I,b as R,c as N,d as O,e as A}from"./index-eiZvAwCW.js";import{R as w}from"./ShoppingOutlined-CRgbW1Qy.js";import{R as B}from"./PieChartOutlined-Dlq3oD_5.js";import{R as U}from"./DollarOutlined-C2PVAe3c.js";import{R as z,L,C as k,X as C,Y as D,T as P,a as _,b as H}from"./recharts-Bl_pMUXE.js";import"./ocrAPI-exwUEzPw.js";import"./aiAPI-Dz5rvtdU.js";import"./socket-CUkmNz_4.js";var V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 248H728l-32.4-90.8a32.07 32.07 0 00-30.2-21.2H358.6c-13.5 0-25.6 8.5-30.1 21.2L296 248H160c-44.2 0-80 35.8-80 80v456c0 44.2 35.8 80 80 80h704c44.2 0 80-35.8 80-80V328c0-44.2-35.8-80-80-80zm8 536c0 4.4-3.6 8-8 8H160c-4.4 0-8-3.6-8-8V328c0-4.4 3.6-8 8-8h186.7l17.1-47.8 22.9-64.2h250.5l22.9 64.2 17.1 47.8H864c4.4 0 8 3.6 8 8v456zM512 384c-88.4 0-160 71.6-160 160s71.6 160 160 160 160-71.6 160-160-71.6-160-160-160zm0 256c-53 0-96-43-96-96s43-96 96-96 96 43 96 96-43 96-96 96z"}}]},name:"camera",theme:"outlined"},M=function(e,s){return t.createElement(a,l({},e,{ref:s,icon:V}))},J=t.forwardRef(M);const{Title:q,Text:E}=i,F=()=>{const a=s(),[l,i]=t.useState({totalUsers:0,totalRevenue:0,activeUsers:0}),[V,M]=t.useState({}),[F,K]=t.useState({totalRevenue:0}),[Y,X]=t.useState(!1),[G,Q]=t.useState([]),[W,Z]=t.useState([]),{data:$,isLoading:ee}=f(),{data:te,isLoading:se}=p(),{data:ae,isLoading:le}=y(),{data:ne,isLoading:ie}=S();t.useEffect(()=>{oe(),re(),ce()},[]);const re=()=>{if(!localStorage.getItem("all_users")){const e=[{id:"1",email:"user1@example.com",fullName:"Nguyễn Văn A",role:"user",status:"active",createdAt:n().subtract(30,"day").toISOString(),lastLogin:n().subtract(1,"hour").toISOString()},{id:"2",email:"user2@example.com",fullName:"Trần Thị B",role:"user",status:"active",createdAt:n().subtract(25,"day").toISOString(),lastLogin:n().subtract(3,"hour").toISOString()},{id:"3",email:"user3@example.com",fullName:"Lê Văn C",role:"user",status:"locked",createdAt:n().subtract(20,"day").toISOString(),lastLogin:n().subtract(5,"day").toISOString()},{id:"4",email:"admin@example.com",fullName:"Admin User",role:"admin",status:"active",createdAt:n().subtract(60,"day").toISOString(),lastLogin:(new Date).toISOString()}];localStorage.setItem("all_users",JSON.stringify(e))}},oe=async()=>{try{const t=JSON.parse(localStorage.getItem("all_users")||"[]"),s=t.filter(e=>"active"===e.status).length;let a=0;try{const e=await v.getRevenueTotals();if(e){const t=e.data||e;a=t.totalRevenue||0}}catch(e){const t=localStorage.getItem("admin_dashboard_revenue");a=t?JSON.parse(t):0}i({totalUsers:t.length,totalRevenue:a,activeUsers:s}),localStorage.setItem("admin_dashboard_revenue",JSON.stringify(a));const l=["T1","T2","T3","T4","T5","T6","T7","T8","T9","T10","T11","T12"].map((e,t)=>({month:e,revenue:Math.max(1e5,Math.floor(a/12+(Math.random()-.5)*a/6))}));Z(l);const r=[{id:"1",user:"Nguyễn Văn A",action:"Thêm chi tiêu mới",amount:"150,000đ",time:n().subtract(5,"minute").fromNow(),type:"expense"},{id:"2",user:"Trần Thị B",action:"Đăng ký tài khoản",time:n().subtract(30,"minute").fromNow(),type:"register"},{id:"3",user:"Lê Văn C",action:"Vượt ngân sách",amount:"2,500,000đ",time:n().subtract(2,"hour").fromNow(),type:"warning"},{id:"4",user:"Phạm Thị D",action:"Thanh toán đăng ký Premium",amount:"199,000đ",time:n().subtract(5,"hour").fromNow(),type:"payment"}];Q(r)}catch(e){i({totalUsers:0,totalRevenue:0,activeUsers:0}),Q([])}},ce=async()=>{var e;X(!0);try{const[t,s]=await Promise.allSettled([b.getStatusStats(),v.getRevenueTotals()]);if("fulfilled"===t.status&&t.value?M(t.value||{}):M({}),"fulfilled"===s.status&&s.value){const t=(null==(e=s.value)?void 0:e.data)||s.value||{totalRevenue:0};K(t)}else K({totalRevenue:0})}catch(t){M({}),K({totalRevenue:0})}finally{X(!1)}},de=t=>{switch(t){case"expense":return e.jsx(U,{style:{color:"#1890ff"}});case"register":return e.jsx(N,{style:{color:"#52c41a"}});case"warning":return e.jsx(O,{style:{color:"#faad14"}});case"payment":return e.jsx(U,{style:{color:"#722ed1"}});default:return e.jsx(A,{})}};return e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(q,{level:2,children:"Admin Dashboard"}),e.jsx(r,{title:"Thống kê Hệ thống",style:{marginBottom:"24px"},children:e.jsxs(o,{gutter:[16,16],children:[e.jsx(c,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(d,{spinning:ee,indicator:e.jsx(x,{style:{fontSize:24}}),children:e.jsx(u,{title:"Số người dùng có chi tiêu",value:(null==$?void 0:$.totalUsers)||0,prefix:e.jsx(T,{}),valueStyle:{color:"#1890ff"}})})})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(d,{spinning:se,indicator:e.jsx(x,{style:{fontSize:24}}),children:e.jsx(u,{title:"Số người dùng có ngân sách",value:(null==te?void 0:te.totalUsers)||0,prefix:e.jsx(T,{}),valueStyle:{color:"#722ed1"}})})})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(d,{spinning:ee,indicator:e.jsx(x,{style:{fontSize:24}}),children:e.jsx(u,{title:"Tổng số chi tiêu",value:(null==$?void 0:$.totalExpenses)||0,prefix:e.jsx(w,{}),valueStyle:{color:"#52c41a"}})})})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(d,{spinning:se,indicator:e.jsx(x,{style:{fontSize:24}}),children:e.jsx(u,{title:"Tổng số ngân sách",value:(null==te?void 0:te.totalBudgets)||0,prefix:e.jsx(B,{}),valueStyle:{color:"#faad14"}})})})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(d,{spinning:le,indicator:e.jsx(x,{style:{fontSize:24}}),children:e.jsx(u,{title:"Tổng số lượt quét OCR",value:(null==ae?void 0:ae.totalJobs)||0,prefix:e.jsx(I,{}),valueStyle:{color:"#13c2c2"}})})})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(d,{spinning:le,indicator:e.jsx(x,{style:{fontSize:24}}),children:e.jsx(u,{title:"Số người dùng dùng OCR",value:(null==ae?void 0:ae.totalUsers)||0,prefix:e.jsx(J,{}),valueStyle:{color:"#eb2f96"}})})})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(d,{spinning:ie,indicator:e.jsx(x,{style:{fontSize:24}}),children:e.jsx(u,{title:"Tổng yêu cầu AI",value:(null==ne?void 0:ne.totalRequests)||0,prefix:e.jsx(R,{}),valueStyle:{color:"#8B5CF6"}})})})}),e.jsx(c,{xs:24,sm:12,md:6,children:e.jsx(r,{hoverable:!0,children:e.jsx(d,{spinning:ie,indicator:e.jsx(x,{style:{fontSize:24}}),children:e.jsx(u,{title:"Người dùng dùng AI",value:(null==ne?void 0:ne.totalUsers)||0,prefix:e.jsx(N,{}),valueStyle:{color:"#6366F1"}})})})})]})}),e.jsxs(o,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx(c,{xs:24,sm:12,lg:6,children:e.jsx(r,{children:e.jsx(u,{title:"Tổng người dùng",value:l.totalUsers,prefix:e.jsx(T,{}),valueStyle:{color:"#3f8600"}})})}),e.jsx(c,{xs:24,sm:12,lg:6,children:e.jsx(r,{children:e.jsx(u,{title:"Người dùng hoạt động",value:l.activeUsers,prefix:e.jsx(N,{}),valueStyle:{color:"#1890ff"}})})}),e.jsx(c,{xs:24,sm:12,lg:6,children:e.jsx(r,{children:e.jsx(u,{title:"Doanh thu",value:l.totalRevenue,prefix:e.jsx(U,{}),suffix:"đ",valueStyle:{color:"#722ed1"}})})})]}),e.jsxs(o,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx(c,{xs:24,sm:12,lg:6,children:e.jsxs(r,{loading:Y,onClick:()=>a("/admin/blog-analytics"),hoverable:!0,children:[e.jsx(u,{title:"Blog chờ duyệt",value:V.pending||0,prefix:e.jsx(O,{}),valueStyle:{color:"#F59E0B"}}),e.jsxs(h,{color:"blue",style:{marginTop:8},children:["Tổng: ",(V.pending||0)+(V.published||0)+(V.rejected||0)+(V.draft||0)]})]})}),e.jsx(c,{xs:24,sm:12,lg:6,children:e.jsxs(r,{loading:Y,onClick:()=>a("/admin/revenue"),hoverable:!0,children:[e.jsx(u,{title:"Doanh thu (tổng)",value:F.totalRevenue||0,prefix:e.jsx(U,{}),suffix:"đ",valueStyle:{color:"#10B981"}}),e.jsxs(h,{color:"green",style:{marginTop:8},children:["Active: ",F.activeSubscriptions??0]})]})})]}),e.jsxs(o,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx(c,{xs:24,lg:16,children:e.jsx(r,{title:"Thống kê theo tháng",children:e.jsx(z,{width:"100%",height:300,children:e.jsxs(L,{data:W,children:[e.jsx(k,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"month"}),e.jsx(D,{}),e.jsx(P,{}),e.jsx(_,{}),e.jsx(H,{type:"monotone",dataKey:"revenue",stroke:"#82ca9d",name:"Doanh thu"})]})})})}),e.jsx(c,{xs:24,lg:8,children:e.jsx(r,{title:"Thông báo nhanh",children:e.jsx(m,{dataSource:[{title:"Người dùng mới",count:5,status:"processing"},{title:"Yêu cầu hỗ trợ",count:2,status:"error"},{title:"Báo cáo chờ duyệt",count:1,status:"default"}],renderItem:t=>e.jsx(m.Item,{children:e.jsxs(j,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsx(E,{children:t.title}),e.jsx(h,{color:t.status,children:t.count})]})})})})})]}),e.jsx(o,{gutter:[16,16],children:e.jsx(c,{xs:24,children:e.jsx(r,{title:"Hoạt động gần đây",children:e.jsx(m,{dataSource:G,renderItem:t=>e.jsx(m.Item,{children:e.jsx(m.Item.Meta,{avatar:e.jsx(g,{icon:de(t.type)}),title:e.jsxs(j,{children:[e.jsx(E,{strong:!0,children:t.user}),e.jsx(E,{type:"secondary",children:t.action}),t.amount&&e.jsx(E,{type:"success",children:t.amount})]}),description:t.time})})})})})})]})};export{F as default};
