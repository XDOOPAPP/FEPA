import{j as t}from"./vendor-CIDEvgjn.js";import{r as e}from"./react-YvAU7kAw.js";import{e as a,f as s,Z as l,B as n,m as r,N as i,C as o,E as d,$ as c,c as u,d as m,w as h,j as x,u as j,Y as p}from"./antd-BDFa4u8q.js";import{g as f,A as g,L as C,e as S}from"./index-eiZvAwCW.js";import{e as v}from"./exportUtils-CGhWYdho.js";import{R as y}from"./CloseCircleOutlined-BiZJkYjc.js";import"./socket-CUkmNz_4.js";const L=async t=>{const e=await f.get(g.PAYMENTS.LOOKUP(t));return e.data||e},A=async()=>{const t=await f.get(g.PAYMENTS.IPN_LOGS);return t.data||t},E={PENDING:{status:"processing",text:"Đang xử lý",icon:t.jsx(p,{})},SUCCESS:{status:"success",text:"Thành công",icon:t.jsx(S,{})},FAILED:{status:"error",text:"Thất bại",icon:t.jsx(y,{})},CANCELLED:{status:"default",text:"Đã hủy"}};function N(){var p,f,g;const[S,y]=e.useState(""),[N,I]=e.useState(!1),[Y,D]=e.useState(null),[b,T]=e.useState([]),[M,P]=e.useState("ALL"),w=async t=>{const e=S;if(e){I(!0);try{const[t,a]=await Promise.all([L(e),A().catch(()=>({data:[]}))]);D((null==t?void 0:t.data)||(null==t?void 0:t.data)||null),T((null==a?void 0:a.data)||[])}catch(a){D(null),T([])}finally{I(!1)}}},k=[{title:"Ref",dataIndex:"ref",key:"ref"},{title:"Status",dataIndex:"status",key:"status",render:e=>{var a;return t.jsx(j,{color:(null==(a=E[e])?void 0:a.color)||"default",children:e})}},{title:"Amount",dataIndex:"amount",key:"amount",render:t=>null==t?void 0:t.toLocaleString("vi-VN")},{title:"Thời gian",dataIndex:"createdAt",key:"createdAt",render:t=>t?m(t).format("DD/MM/YYYY HH:mm"):"-"}],H="ALL"===M?b:b.filter(t=>t.status===M);return t.jsx(C,{loading:N,children:t.jsxs("div",{style:{padding:24},children:[t.jsxs(a,{style:{width:"100%",justifyContent:"space-between",marginBottom:16},children:[t.jsx("h2",{style:{margin:0},children:"Tra cứu thanh toán"}),t.jsxs(a,{children:[t.jsx(s,{placeholder:"Nhập mã thanh toán (ref)",value:S,onChange:t=>y(t.target.value),onPressEnter:()=>w(),style:{width:280},prefix:t.jsx(l,{})}),t.jsx(n,{type:"primary",icon:t.jsx(l,{}),onClick:()=>w(),children:"Tra cứu"}),t.jsx(n,{icon:t.jsx(r,{}),onClick:()=>{D(null),T([]),y("")},children:"Làm mới"}),t.jsx(n,{icon:t.jsx(i,{}),onClick:()=>{v(H.map(t=>({Ref:t.ref,Trang_thai:t.status,So_tien:t.amount,Thoi_gian:t.createdAt?m(t.createdAt).format("DD/MM/YYYY HH:mm"):""})),{filename:"ipn-logs"})},children:"Export CSV"})]})]}),t.jsx(o,{title:"Chi tiết thanh toán",style:{marginBottom:16},children:Y?t.jsxs(c,{bordered:!0,column:2,size:"middle",children:[t.jsx(c.Item,{label:"Mã thanh toán",children:Y.ref}),t.jsx(c.Item,{label:"Trạng thái",children:t.jsx(u,{status:(null==(p=E[Y.status])?void 0:p.status)||"default",text:(null==(f=E[Y.status])?void 0:f.text)||Y.status})}),t.jsxs(c.Item,{label:"Số tiền",children:[null==(g=Y.amount)?void 0:g.toLocaleString("vi-VN")," ",Y.currency||"VND"]}),t.jsx(c.Item,{label:"Gói",children:Y.planName||"-"}),t.jsx(c.Item,{label:"User",children:Y.userEmail||"-"}),t.jsx(c.Item,{label:"Cổng",children:Y.gateway||"-"}),t.jsx(c.Item,{label:"Tạo lúc",children:Y.createdAt?m(Y.createdAt).format("DD/MM/YYYY HH:mm"):"-"}),t.jsx(c.Item,{label:"Cập nhật",children:Y.updatedAt?m(Y.updatedAt).format("DD/MM/YYYY HH:mm"):"-"})]}):t.jsx(d,{description:"Nhập mã thanh toán để tra cứu"})}),t.jsx(o,{title:"IPN Logs (VNPay)",children:b.length?t.jsx(h,{dataSource:H,columns:k,rowKey:t=>t.id||`${t.ref}-${t.createdAt}`,pagination:{pageSize:5},title:()=>t.jsxs(a,{children:[t.jsx("span",{children:"Lọc theo trạng thái:"}),t.jsx(x,{size:"small",value:M,onChange:P,style:{width:160},options:[{label:"Tất cả",value:"ALL"},{label:"PENDING",value:"PENDING"},{label:"SUCCESS",value:"SUCCESS"},{label:"FAILED",value:"FAILED"},{label:"CANCELLED",value:"CANCELLED"}]})]})}):t.jsx(d,{description:"Chưa có log"})})]})})}export{N as default};
