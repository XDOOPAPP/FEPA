import{j as e}from"./vendor-CIDEvgjn.js";import{r as t}from"./react-YvAU7kAw.js";import{I as a,_ as l,T as n,e as s,B as i,V as r,R as c,P as o,Z as d,C as h,F as u,z as m,d as g,f as x,j as p,G as f,H as v,g as j,u as k,K as y,D as w,s as b}from"./antd-B4HmBe3_.js";import{g as A,e as C,c as S,j as I}from"./index-CWIbmrm_.js";import{e as z}from"./exportUtils-CGhWYdho.js";import"./socket-CUkmNz_4.js";const T=async e=>{const t={};return(null==e?void 0:e.search)&&(t.search=e.search),(null==e?void 0:e.status)&&"ALL"!==e.status&&(t.status=e.status),(null==e?void 0:e.role)&&"ALL"!==e.role&&(t.role=e.role),(null==e?void 0:e.verified)&&"ALL"!==e.verified&&(t.verified=e.verified),(null==e?void 0:e.page)&&(t.page=e.page),(null==e?void 0:e.pageSize)&&(t.pageSize=e.pageSize),await A.get("/auth/users",{params:t})},M=async e=>await A.patch(`/auth/users/${e}/deactivate`),L=async e=>await A.patch(`/auth/users/${e}/reactivate`),H=async e=>await A.delete(`/auth/users/${e}`);var E={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},N=function(e,n){return t.createElement(a,l({},e,{ref:n,icon:E}))},V=t.forwardRef(N),B={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M608 112c-167.9 0-304 136.1-304 304 0 70.3 23.9 135 63.9 186.5l-41.1 41.1-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-44.9 44.9-62.3-62.3a8.15 8.15 0 00-11.4 0l-39.8 39.8a8.15 8.15 0 000 11.4l62.3 62.3-65.3 65.3a8.03 8.03 0 000 11.3l42.3 42.3c3.1 3.1 8.2 3.1 11.3 0l253.6-253.6A304.06 304.06 0 00608 720c167.9 0 304-136.1 304-304S775.9 112 608 112zm161.2 465.2C726.2 620.3 668.9 644 608 644c-60.9 0-118.2-23.7-161.2-66.8-43.1-43-66.8-100.3-66.8-161.2 0-60.9 23.7-118.2 66.8-161.2 43-43.1 100.3-66.8 161.2-66.8 60.9 0 118.2 23.7 161.2 66.8 43.1 43 66.8 100.3 66.8 161.2 0 60.9-23.7 118.2-66.8 161.2z"}}]},name:"key",theme:"outlined"},D=function(e,n){return t.createElement(a,l({},e,{ref:n,icon:B}))},Y=t.forwardRef(D),R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},U=function(e,n){return t.createElement(a,l({},e,{ref:n,icon:R}))},F=t.forwardRef(U),$={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v68c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-68c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zm-40 376H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"unlock",theme:"outlined"},X=function(e,n){return t.createElement(a,l({},e,{ref:n,icon:$}))},O=t.forwardRef(X);const{Text:P}=n,K=({selectedCount:t,onClearSelection:a,actions:l=[],loading:n=!1})=>{if(0===t)return null;return e.jsxs("div",{style:{position:"fixed",bottom:24,left:"50%",transform:"translateX(-50%)",zIndex:1e3,background:"#fff",padding:"12px 24px",borderRadius:8,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",gap:16},children:[e.jsx(C,{style:{color:"#1890ff",fontSize:20}}),e.jsxs(P,{strong:!0,children:["Đã chọn ",t," ",1===t?"item":"items"]}),e.jsxs(s,{children:[l.map(a=>{const l=e.jsx(i,{icon:a.icon,danger:a.danger,loading:n,onClick:a.onClick,children:a.label},a.key);return a.confirm?e.jsx(o,{title:a.confirmTitle||`Bạn có chắc chắn muốn ${a.label.toLowerCase()} ${t} items?`,onConfirm:a.onClick,okText:"Có",cancelText:"Không",okButtonProps:{danger:a.danger},children:e.jsx(i,{icon:a.icon,danger:a.danger,loading:n,children:a.label})},a.key):l}),e.jsx(i,{icon:e.jsx(r,{}),onClick:a,disabled:n,children:"Bỏ chọn"})]})]})},q=t=>({key:"delete",label:"Xóa",icon:e.jsx(c,{}),danger:!0,confirm:!0,confirmTitle:"Bạn có chắc chắn muốn xóa các items đã chọn?",onClick:t}),_=t=>({key:"export",label:"Export",icon:e.jsx(V,{}),onClick:t}),G=({type:t="text",rows:a=3,active:l=!0,loading:n=!0,children:s})=>{if(!n)return e.jsx(e.Fragment,{children:s});switch(t){case"card":return e.jsx(h,{children:e.jsx(d,{active:l,avatar:!0,paragraph:{rows:4}})});case"table":return e.jsx("div",{style:{padding:"20px"},children:Array.from({length:a}).map((t,a)=>e.jsx(d,{active:l,paragraph:{rows:0},style:{marginBottom:"16px"}},a))});case"form":return e.jsxs("div",{style:{padding:"20px"},children:[e.jsx(d.Input,{active:l,style:{width:"100%",marginBottom:"16px"}}),e.jsx(d.Input,{active:l,style:{width:"100%",marginBottom:"16px"}}),e.jsx(d.Input,{active:l,style:{width:"100%",marginBottom:"16px"}}),e.jsx(d.Button,{active:l,style:{width:"100px",marginTop:"16px"}})]});case"list":return e.jsx("div",{children:Array.from({length:a}).map((t,a)=>e.jsx(h,{style:{marginBottom:"16px"},children:e.jsx(d,{active:l,avatar:!0,paragraph:{rows:2}})},a))});default:return e.jsx(d,{active:l,paragraph:{rows:a}})}},Q=({rows:t=5,loading:a=!0,children:l})=>e.jsx(G,{type:"table",rows:t,loading:a,children:l}),{Title:Z}=n,J=()=>{const[a,l]=t.useState([]),[n,r]=t.useState(!1),[o,d]=t.useState(null),[A]=u.useForm(),[C,E]=t.useState(!0),[N,V]=t.useState({status:"ALL",role:"ALL",verified:"ALL",page:1,pageSize:10}),[B,D]=t.useState(0),{selectedIds:R,selectedItems:U,isAllSelected:$,isSomeSelected:X,toggleItem:P,toggleAll:G,deselectAll:J,isSelected:W}=function({items:e,getItemId:a}){const[l,n]=t.useState(new Set),s=Array.isArray(e)?e:[],i=t.useMemo(()=>s.map(a),[s,a]),r=t.useMemo(()=>i.length>0&&i.every(e=>l.has(e)),[i,l]),c=t.useMemo(()=>l.size>0&&!r,[l.size,r]),o=t.useMemo(()=>s.filter(e=>l.has(a(e))),[s,l,a]),d=t.useCallback(e=>{n(t=>new Set(t).add(e))},[]),h=t.useCallback(e=>{n(t=>{const a=new Set(t);return a.delete(e),a})},[]),u=t.useCallback(e=>{n(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),m=t.useCallback(()=>{n(new Set(i))},[i]),g=t.useCallback(()=>{n(new Set)},[]),x=t.useCallback(()=>{r?g():m()},[r,m,g]),p=t.useCallback(e=>l.has(e),[l]);return{selectedIds:l,selectedItems:o,isAllSelected:r,isSomeSelected:c,selectedCount:l.size,selectItem:d,deselectItem:h,toggleItem:u,selectAll:m,deselectAll:g,toggleAll:x,isSelected:p}}({items:a,getItemId:e=>e.id});t.useEffect(()=>{ee()},[]);const ee=async()=>{E(!0);try{const e=await T(N)||{},t=(Array.isArray(e.data)?e.data:e.users||e.items||[]).map(e=>{const t=(e.role||"USER").toUpperCase();return{id:e.id||e._id,email:e.email,fullName:e.fullName||e.name,role:t,status:e.isActive?"active":"locked",createdAt:e.createdAt,lastLogin:e.lastLogin||e.createdAt}});l(t),D(e.total||t.length)}catch(e){l([])}finally{E(!1)}},te=e=>{V(t=>({...t,...e,page:1})),ee()},ae=[{title:e.jsx(j,{checked:$,indeterminate:X,onChange:G}),key:"checkbox",width:50,render:(t,a)=>e.jsx(j,{checked:W(a.id),onChange:()=>P(a.id)})},{title:"Email",dataIndex:"email",key:"email",sorter:(e,t)=>e.email.localeCompare(t.email)},{title:"Họ tên",dataIndex:"fullName",key:"fullName",sorter:(e,t)=>e.fullName.localeCompare(t.fullName)},{title:"Vai trò",dataIndex:"role",key:"role",render:t=>{const a="SUPER_ADMIN"===t,l="ADMIN"===t;return e.jsx(k,{color:a?"gold":l?"red":"blue",children:a?"Super Admin":l?"Admin":"User"})},filters:[{text:"Super Admin",value:"SUPER_ADMIN"},{text:"Admin",value:"ADMIN"},{text:"User",value:"USER"}],onFilter:(e,t)=>t.role===e},{title:"Trạng thái",dataIndex:"status",key:"status",render:t=>e.jsx(k,{color:"active"===t?"green":"red",children:"active"===t?"Hoạt động":"Đã khóa"}),filters:[{text:"Hoạt động",value:"active"},{text:"Đã khóa",value:"locked"}],onFilter:(e,t)=>t.status===e},{title:"Ngày tạo",dataIndex:"createdAt",key:"createdAt",render:e=>g(e).format("DD/MM/YYYY HH:mm"),sorter:(e,t)=>g(e.createdAt).unix()-g(t.createdAt).unix()},{title:"Đăng nhập cuối",dataIndex:"lastLogin",key:"lastLogin",render:e=>g(e).format("DD/MM/YYYY HH:mm"),sorter:(e,t)=>g(e.lastLogin).unix()-g(t.lastLogin).unix()},{title:"Thao tác",key:"action",width:180,render:(t,a)=>{const l=[{key:"edit",label:"Sửa",icon:e.jsx(y,{}),onClick:()=>(e=>{d(e),A.setFieldsValue(e),r(!0)})(a)},{key:"toggle",label:"active"===a.status?"Khóa":"Mở",icon:"active"===a.status?e.jsx(I,{}):e.jsx(O,{}),onClick:()=>(e=>{(async()=>{try{const t="active"===e.status?"locked":"active";"locked"===t?await M(e.id):await L(e.id),await ee(),b.success("locked"===t?"Đã khóa người dùng":"Đã mở khóa người dùng")}catch(t){b.error("Thao tác thất bại")}})()})(a)},{key:"reset",label:"Reset MK",icon:e.jsx(Y,{}),onClick:()=>(e=>{v.confirm({title:"Xác nhận reset mật khẩu",content:`Bạn có chắc muốn reset mật khẩu cho ${e.fullName}?`,onOk:()=>{b.info("Tính năng reset mật khẩu sẽ được bổ sung sau")}})})(a)},{key:"delete",label:"Xóa",icon:e.jsx(c,{}),danger:!0,onClick:()=>{return e=a.id,void v.confirm({title:"Xác nhận xóa",content:"Bạn có chắc muốn xóa người dùng này?",onOk:async()=>{try{await H(e),await ee(),b.success("Xóa người dùng thành công")}catch(t){b.error("Xóa user thất bại")}}});var e}}];return e.jsx(w,{menu:{items:l.map(t=>({key:t.key,label:e.jsxs(s,{size:"small",onClick:t.onClick,children:[t.icon,e.jsx("span",{children:t.label})]}),danger:t.danger}))},trigger:["click"],placement:"bottomRight",children:e.jsx(i,{type:"text",icon:e.jsx(F,{}),children:"Thao tác"})})}}];return e.jsxs("div",{children:[e.jsx(h,{title:e.jsxs(Z,{level:3,children:[e.jsx(S,{})," Quản lý người dùng"]}),extra:e.jsxs(s,{wrap:!0,children:[e.jsx(x.Search,{allowClear:!0,placeholder:"Tìm theo email/họ tên",onSearch:e=>{V(t=>({...t,search:e,page:1})),ee()},style:{width:260}}),e.jsx(p,{value:N.status,onChange:e=>te({status:e}),style:{width:140},options:[{label:"Tất cả",value:"ALL"},{label:"Hoạt động",value:"ACTIVE"},{label:"Đã khóa",value:"INACTIVE"}]}),e.jsx(p,{value:N.role,onChange:e=>te({role:e}),style:{width:140},options:[{label:"Tất cả",value:"ALL"},{label:"User",value:"USER"},{label:"Admin",value:"ADMIN"}]}),e.jsx(p,{value:N.verified,onChange:e=>te({verified:e}),style:{width:160},options:[{label:"Tất cả",value:"ALL"},{label:"Đã xác thực",value:"VERIFIED"},{label:"Chưa xác thực",value:"UNVERIFIED"}]}),e.jsx(i,{type:"primary",icon:e.jsx(f,{}),onClick:()=>{d(null),A.resetFields(),r(!0)},children:"Thêm"})]}),children:e.jsx(Q,{rows:5,loading:C,children:e.jsx(m,{dataSource:a,columns:ae,rowKey:"id",pagination:{current:N.page,pageSize:N.pageSize,total:B,showSizeChanger:!0,showTotal:e=>`Tổng ${e} người dùng`},onChange:e=>{const{current:t,pageSize:a}=e;V(e=>({...e,page:t,pageSize:a})),ee()},style:{width:"100%"},tableLayout:"auto"})})}),e.jsx(K,{selectedCount:R.size,onClearSelection:J,actions:[q(()=>{v.confirm({title:"Xác nhận xóa nhiều",content:`Bạn có chắc muốn xóa ${R.size} người dùng đã chọn?`,onOk:async()=>{try{const e=Array.from(R);await Promise.all(e.map(e=>H(e))),J(),await ee(),b.success(`Đã xóa ${e.length} người dùng`)}catch(e){b.error("Xóa nhiều thất bại")}}})}),_(()=>{const e=U.map(e=>({Email:e.email,"Họ tên":e.fullName,"Vai trò":"ADMIN"===e.role?"Admin":"User","Trạng thái":"active"===e.status?"Hoạt động":"Đã khóa","Ngày tạo":g(e.createdAt).format("DD/MM/YYYY HH:mm"),"Đăng nhập cuối":g(e.lastLogin).format("DD/MM/YYYY HH:mm")}));z(e,{filename:"users-export"}),b.success(`Đã export ${R.size} người dùng`)})]}),e.jsx(v,{title:o?"Sửa người dùng":"Thêm người dùng mới",open:n,onOk:async()=>{try{await A.validateFields(),b.info("Tính năng tạo/cập nhật người dùng sẽ được bổ sung sau"),r(!1),A.resetFields(),await ee()}catch(e){b.error("Thao tác thất bại")}},onCancel:()=>{r(!1),A.resetFields()},width:600,okText:o?"Cập nhật":"Thêm",cancelText:"Hủy",children:e.jsxs(u,{form:A,layout:"vertical",style:{marginTop:"20px"},children:[e.jsx(u.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Vui lòng nhập email"},{type:"email",message:"Email không hợp lệ"}],children:e.jsx(x,{prefix:e.jsx(S,{}),placeholder:"example@email.com"})}),e.jsx(u.Item,{label:"Họ tên",name:"fullName",rules:[{required:!0,message:"Vui lòng nhập họ tên"}],children:e.jsx(x,{placeholder:"Nguyễn Văn A"})}),e.jsx(u.Item,{label:"Vai trò",name:"role",rules:[{required:!0,message:"Vui lòng chọn vai trò"}],children:e.jsxs(p,{placeholder:"Chọn vai trò",children:[e.jsx(p.Option,{value:"user",children:"User"}),e.jsx(p.Option,{value:"admin",children:"Admin"})]})}),!o&&e.jsx(u.Item,{label:"Mật khẩu",name:"password",rules:[{required:!0,message:"Vui lòng nhập mật khẩu"},{min:6,message:"Mật khẩu phải có ít nhất 6 ký tự"}],children:e.jsx(x.Password,{placeholder:"Nhập mật khẩu"})})]})})]})};export{J as default};
